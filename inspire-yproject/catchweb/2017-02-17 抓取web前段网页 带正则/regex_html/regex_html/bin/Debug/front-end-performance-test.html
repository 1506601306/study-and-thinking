<!DOCTYPE html>
<html>
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="google-site-verification" content="0FNbiBWk1FugWYo-RiGxQyIHebGeLoXp3HB7AxIFKy8" />
    <meta name="baidu-site-verification" content="tYoUqpkCCv" />
    <meta name="baidu-site-verification" content="IGN97NW90O" />
    
    <title>前端性能测试 | ouvenzhang的博客</title>

    <meta http-equiv="x-dns-prefetch-control" content="on" />
    <link rel="dns-prefetch" href="cdnjs.cloudflare.com" />
    <link rel="dns-prefetch" href="1.url.cn" />

    <meta name="description" itemprop="description" content="前端性能测试,前端性能,性能测试 ">
    <meta itemprop="name" content="前端性能测试">
    <meta itemprop="image" content="http://ouvens.github.io/blog/assets/logo.png">
    <meta itemprop="keywords" name="keywords" content="前端性能测试,前端性能,性能测试 ">

    
    <meta name="author" content="ouvenzhang">
    <meta name="copyright" content="&copy; ouvenzhang 2017">
    <meta name="protocol" content="1">
    

    <!-- External libraries -->
    <link rel="stylesheet" href="/assets/css/iconfont.css">
    <link rel="stylesheet" href="/css/monokai_sublime.css">

    <!-- Favicon and other icons (made with http://www.favicon-generator.org/) -->
    <link rel="shortcut icon" href="/assets/favicon.ico" type="image/x-icon">
  	<link rel="icon" href="/assets/favicon.ico" type="image/x-icon">
    
  	<meta name="msapplication-TileColor" content="#ffffff">
  	<meta name="theme-color" content="#ffffff">
    <meta name="msapplication-TileImage" content="/assets/icons/icon.png">

  	<!-- Site styles -->
    <link rel="stylesheet" href="/css/main.css">

    <link rel="alternate" type="application/rss+xml" title="极限前端" href="http://ouvens.github.io//feed.xml" />
    <script>
    // 访问统计
    var domain = 'jixianqianduan.com';
    var oldDomain = 'ouvens.github.io';
    if(location.host === domain){
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "//hm.baidu.com/hm.js?b536b128dc21c3d18fdc028f0609e3f0";
          var s = document.getElementsByTagName("script")[0]; 
          s.parentNode.insertBefore(hm, s);
        })();
    }else if(location.host === oldDomain){
        window.location.href = location.href.replace(oldDomain, domain);
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "//hm.baidu.com/hm.js?041efd2cb345ca1b9dbdbb2383cb716d";
          var s = document.getElementsByTagName("script")[0]; 
          s.parentNode.insertBefore(hm, s);
        })();
    }

    // 链接提交

    if(location.protocol === 'https'){
        !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=window.location.href,t=document.referrer;if(!e.test(r)){var o="https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif";t?(o+="?r="+encodeURIComponent(document.referrer),r&&(o+="&l="+r)):r&&(o+="?l="+r);var i=new Image;i.src=o}}(window);
    }else{
        !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=window.location.href,o=document.referrer;if(!e.test(r)){var n="//api.share.baidu.com/s.gif";o?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var t=new Image;t.src=n}}(window);
    }


    </script>
</head>

    <body>
        <div class="navigation" role="banner">
    <div class="navigation-wrapper">
    <a href="/" class="logo">
    	
      <img src="/assets/logo.png" alt="极限前端">
      
    </a>
    <span class="search-input" id="search-input">
      <input type="text" value="" class="search-text" placeholder="输入搜索关键字">
      <i class="icon-font i-search search-btn"></i>
    </span>
    <a href="javascript:void(0)" class="navigation-menu-button" id="js-mobile-menu">
    	<i class="icon-font i-list fa fa-bars"></i>
    </a>
    <span class="nav" role="navigation">
      <ul id="js-navigation-menu" class="navigation-menu show">
      	
          
          <li class="nav-link">
            <a href="/about/">关于</a>
          </li>
          
        
          
        
          
        
          
        
          
          <li class="nav-link">
            <a href="/category/">所有文章</a>
          </li>
          
        
          
          <li class="nav-link">
            <a href="/tags/">标签分类</a>
          </li>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          <li id="github-info" class="nav-link" title="https://github.com/ouvens">
            <a class="github-info" href="https://github.com/ouvens" target="_blank">
            <img src="/assets/github.png" height="34" width="130" alt="github地址"></a>
          </li>
      </ul>
    </span>
  </div>
</div>

            <div class="page-content">
        <div class="post">
<div class="post-header-container has-cover">
	<header class="post-header">
	  <h1 class="title">前端性能测试</h1>
	  <p class="info">by <strong>ouven</strong></p>
	</header>
</div>
<div class="wrapper">



<div class="post-meta">
	<div class="post-date">2015年03月16日</div>
	<div class="post-categories">
	 in  
		<a target="_blank" href="/category/?cate=frontend-weboptimize">Frontend-weboptimize</a>
	  
	</div>
</div>	

<article class="post-content">
  <h3 id="performance-timing-api">一、performance timing API</h3>
<p>performance timing API支持ie9以上浏览器，页面请求的整个过程和performance API记录的点</p>

<p><img src="http://7tszky.com1.z0.glb.clouddn.com/FqJwnMWrQQ50yyfCN7VyLHBBtuS7" alt="" /></p>

<p>http://javascript.ruanyifeng.com/bom/performance.html</p>

<p>根据这个过程 performance.timing会记录页面请求的各个点的timestamp，经过简单输出，就可以得到页面请求每个过程所消耗的时间了。
也可以使用现有的实现，原理和以上代码相同：</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></td><td class="code"><pre><span class="kd">function</span> <span class="nx">performanceTest</span><span class="p">(){</span>

    <span class="kd">var</span> <span class="nx">timing</span> <span class="o">=</span> <span class="nx">performance</span><span class="p">.</span><span class="nx">timing</span><span class="p">,</span>
        <span class="nx">readyStart</span> <span class="o">=</span> <span class="nx">timing</span><span class="p">.</span><span class="nx">fetchStart</span> <span class="o">-</span> <span class="nx">timing</span><span class="p">.</span><span class="nx">navigationStart</span><span class="p">,</span>
        <span class="nx">redirectTime</span> <span class="o">=</span> <span class="nx">timing</span><span class="p">.</span><span class="nx">redirectEnd</span>  <span class="o">-</span> <span class="nx">timing</span><span class="p">.</span><span class="nx">redirectStart</span><span class="p">,</span>
        <span class="nx">appcacheTime</span> <span class="o">=</span> <span class="nx">timing</span><span class="p">.</span><span class="nx">domainLookupStart</span>  <span class="o">-</span> <span class="nx">timing</span><span class="p">.</span><span class="nx">fetchStart</span><span class="p">,</span>
        <span class="nx">unloadEventTime</span> <span class="o">=</span> <span class="nx">timing</span><span class="p">.</span><span class="nx">unloadEventEnd</span> <span class="o">-</span> <span class="nx">timing</span><span class="p">.</span><span class="nx">unloadEventStart</span><span class="p">,</span>
        <span class="nx">lookupDomainTime</span> <span class="o">=</span> <span class="nx">timing</span><span class="p">.</span><span class="nx">domainLookupEnd</span> <span class="o">-</span> <span class="nx">timing</span><span class="p">.</span><span class="nx">domainLookupStart</span><span class="p">,</span>
        <span class="nx">connectTime</span> <span class="o">=</span> <span class="nx">timing</span><span class="p">.</span><span class="nx">connectEnd</span> <span class="o">-</span> <span class="nx">timing</span><span class="p">.</span><span class="nx">connectStart</span><span class="p">,</span>
        <span class="nx">requestTime</span> <span class="o">=</span> <span class="nx">timing</span><span class="p">.</span><span class="nx">responseEnd</span> <span class="o">-</span> <span class="nx">timing</span><span class="p">.</span><span class="nx">requestStart</span><span class="p">,</span>
        <span class="nx">initDomTreeTime</span> <span class="o">=</span> <span class="nx">timing</span><span class="p">.</span><span class="nx">domInteractive</span> <span class="o">-</span> <span class="nx">timing</span><span class="p">.</span><span class="nx">responseEnd</span><span class="p">,</span>
        <span class="nx">domReadyTime</span> <span class="o">=</span> <span class="nx">timing</span><span class="p">.</span><span class="nx">domComplete</span> <span class="o">-</span> <span class="nx">timing</span><span class="p">.</span><span class="nx">domInteractive</span><span class="p">,</span>
        <span class="nx">loadEventTime</span> <span class="o">=</span> <span class="nx">timing</span><span class="p">.</span><span class="nx">loadEventEnd</span> <span class="o">-</span> <span class="nx">timing</span><span class="p">.</span><span class="nx">loadEventStart</span><span class="p">,</span>
        <span class="nx">loadTime</span> <span class="o">=</span> <span class="nx">timing</span><span class="p">.</span><span class="nx">loadEventEnd</span> <span class="o">-</span> <span class="nx">timing</span><span class="p">.</span><span class="nx">navigationStart</span><span class="p">;</span>

        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'准备新页面时间耗时: '</span> <span class="o">+</span> <span class="nx">readyStart</span><span class="p">);</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'redirect 重定向耗时: '</span> <span class="o">+</span> <span class="nx">redirectTime</span><span class="p">);</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Appcache 耗时: '</span> <span class="o">+</span> <span class="nx">appcacheTime</span><span class="p">);</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'unload 前文档耗时: '</span> <span class="o">+</span> <span class="nx">unloadEventTime</span><span class="p">);</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'DNS 查询耗时: '</span> <span class="o">+</span> <span class="nx">lookupDomainTime</span><span class="p">);</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'TCP连接耗时: '</span> <span class="o">+</span> <span class="nx">connectTime</span><span class="p">);</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'request请求耗时: '</span> <span class="o">+</span> <span class="nx">requestTime</span><span class="p">);</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'请求完毕至DOM加载: '</span> <span class="o">+</span> <span class="nx">initDomTreeTime</span><span class="p">);</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'解释dom树耗时: '</span> <span class="o">+</span> <span class="nx">domReadyTime</span><span class="p">);</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'load事件耗时: '</span> <span class="o">+</span> <span class="nx">loadEventTime</span><span class="p">);</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'加载时间耗时: '</span> <span class="o">+</span> <span class="nx">loadTime</span><span class="p">);</span>

<span class="p">}</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>总结分析：
1，对我们有用的，解释dom树耗时、load事件耗时、整个事件耗时作为整体性能参考
2，优化从dom树解析和事件绑定两个方面进行考虑</p>

<p>一些其他的能力：
performance.memory<br />
performance.navigator 
performance.now()   performance.now方法返回当前网页自从performance.timing.navigationStart到当前时间之间的微秒数（毫秒的千分之一）。也就是说，它的精度可以达到100万分之一秒
performance.mark()  mark方法用于为相应的视点做标记
performance.getEntries()  浏览器获取网页时，会对网页中每一个对象（脚本文件、样式表、图片文件等等）发出一个HTTP请求。performance.getEntries方法以数组形式，返回这些请求的时间统计信息，有多少个请求，返回数组就会有多少个成员。
performance.navigation performance还可以提供一些用户行为信息，主要都存放在performance.navigation对象上面。</p>

<p>performance.navigation.redirectCount 该属性表示当前网页经过了多少次重定向跳转。</p>

<p>应用：performanceTracer 和 perfmap
perfmap: 匹配页面上说有的/url((“?http.*”?))/ig 请求，使用performance.getEntries获取每个请求的timing</p>

<h3 id="profile">二、profile工具</h3>

<p>html5 performance API描述了加载到渲染各个阶段的执行情况，但是无法知道页面中js执行的各个动作所需要的时间。
    profile是chrome和火狐的标准浏览器带有的一种测试页面运行时间及时间内动作的性能分析api，以chrome为例，结合浏览器的profile功能，我们可以做以下几个事情：
    1、分析页面js执行的每个过程时间和分析出页面交互过程最耗时的操作
    2、分析页面执行过程中js对象或dom对象堆栈内存的使用情况
    3、记录js对象消耗的内存情况
    4、检测一段时间内CPU占用情况</p>

<p>例如使用console.profile()和console.profileEnd()，就可以分析中间一段代码的执行情况：</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre>
<span class="nx">console</span><span class="p">.</span><span class="nx">profile</span><span class="p">();</span>
<span class="c1">//TO DOS</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">profileEnd</span><span class="p">();</span>

</pre></td></tr></tbody></table>
</div>
</div>

<h3 id="section">三、打点测试</h3>

<p>使用profile可以一定程度上帮助我们分析页面的性能情况，但是缺点是不够灵活，例如我们希望检测每段代码执行的具体情况，我们不可能写很多的console.profile()和console.profileEnd()，为了更加灵活的控制页面js的执行情况，这是需要自己打点计时来计算每部分代码的运行情况。
        原理也相当简单，记录js代码开始执行的timestamp，后面在需要记录的地方打点记录timestamp，最后通过差值来计算每段js的运行时间。然后对于重复操作，我们可以用下面的例子</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></td><td class="code"><pre><span class="kd">var</span> <span class="nx">T</span> <span class="o">=</span> <span class="p">[];</span> <span class="kd">function</span> <span class="nx">PT</span><span class="p">(</span><span class="nx">tag</span><span class="p">){</span> <span class="nx">T</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span><span class="s2">"tag"</span><span class="p">:</span><span class="nx">tag</span><span class="p">,</span><span class="s2">"time"</span><span class="p">:</span><span class="o">+</span><span class="k">new</span> <span class="nb">Date</span><span class="p">});</span> <span class="p">}</span>
<span class="nx">PT</span><span class="p">(</span><span class="s2">"loading"</span><span class="p">);</span>

<span class="nx">T</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span><span class="s2">"tag"</span><span class="p">:</span><span class="s2">"load"</span><span class="p">,</span><span class="s2">"time"</span><span class="p">:</span><span class="o">+</span><span class="k">new</span> <span class="nb">Date</span><span class="p">()});</span>
<span class="c1">//TO DOS</span>
<span class="nx">T</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span><span class="s2">"tag"</span><span class="p">:</span><span class="s2">"load"</span><span class="p">,</span><span class="s2">"time"</span><span class="p">:</span><span class="o">+</span><span class="k">new</span> <span class="nb">Date</span><span class="p">()});</span>

<span class="kd">function</span> <span class="nx">outputTime</span><span class="p">(</span><span class="nx">T</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">timeStep</span> <span class="o">=</span> <span class="p">{},</span>
        <span class="nx">endTime</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="nx">len</span> <span class="o">=</span> <span class="nx">T</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="nx">i</span> <span class="o">++</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">T</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="k">continue</span><span class="p">;</span>

        <span class="nx">endTime</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="o">=</span> <span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span> <span class="p">){</span>
            <span class="k">if</span><span class="p">(</span><span class="nx">T</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">T</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">tag</span> <span class="o">==</span> <span class="nx">T</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">tag</span><span class="p">){</span>
                <span class="nx">endTime</span><span class="p">.</span><span class="nx">tag</span> <span class="o">=</span> <span class="nx">T</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">tag</span><span class="p">;</span>
                <span class="nx">endTime</span><span class="p">.</span><span class="nx">time</span> <span class="o">=</span> <span class="nx">T</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">time</span><span class="p">;</span>
                <span class="nx">T</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">endTime</span><span class="p">.</span><span class="nx">time</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">endTime</span><span class="p">.</span><span class="nx">tag</span><span class="p">){</span>
            <span class="nx">timeStep</span><span class="p">[</span><span class="nx">endTime</span><span class="p">.</span><span class="nx">tag</span><span class="p">]</span> <span class="o">=</span> <span class="nx">endTime</span><span class="p">.</span><span class="nx">time</span> <span class="o">-</span> <span class="nx">T</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">time</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">timeStep</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>最后分析数组之间的间隔就可以分析出执行时间。</p>

<h3 id="timeline">四、timeline分析</h3>
<p>浏览器的timeline可以粗粒度的分析浏览器的文件的请求耗时和加载顺序，这里不进行讲述。</p>

<h3 id="resource-timing">五，resource timing</h3>
<p>通过资源价值情况来分析前端页面的性能</p>

</article>


<div class="tags">
	<strong>Tags:</strong> <a target="_blank" href="/tags/?tag=前端性能">前端性能</a>,&nbsp;<a target="_blank" href="/tags/?tag=性能测试">性能测试</a>
</div>


	<script src="/assets/js/github.comment.js"></script>
	<div class="gc-comments" data-repos="ouvens/ouvens.github.io" data-issues="3" >
	    <div class="gc-comments-title">
	        评论
	    </div>
	    <div class="gc-comments-info">
	        想在此留下评论，请访问 <a href="issues_link">issues_link</a> 提交评论
	    </div>
	</div>
</div>
</div>


    </div>
    
<div class="qr-code qr-code-pay" title="加个微信交流交流">
    <img src="/assets/qrcode/qr-code-person.jpg" width="200" height="200" alt="公众号">
    <p>加我赏红包，哈哈哈</p>
</div>

<div class="qr-code qr-code-wx" title="定期获取更新动态">
    <img src="/assets/qrcode/qrcode.jpg" width="200" height="200" alt="公众号">
    <p>欢迎关注 <strong>极限前端</strong> 公众号</p>
</div>


    
<footer class="site-footer">
  <div class="wrapper">
    <h3 class="footer-heading">极限前端</h3>
    <div class="site-navigation">
    	<p><strong>站内</strong></p>
      <ul class="pages">
        
        
          <li class="nav-link"><a href="/about/">关于</a>
        
        
        
        
        
        
        
        
        
          <li class="nav-link"><a href="/category/">所有文章</a>
        
        
        
          <li class="nav-link"><a href="/tags/">标签分类</a>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
      </ul>
    </div>
    <div class="site-contact">
    	<p><strong>相关链接</strong></p>
        <ul class="social-media-list">
      	<li>
      		<a href="mailto:1025224452@qq.com">
	      		<i class="icon-font i-star"></i>
	      		<span class="username">1025224452@qq.com</span>
      		</a>
      	</li>

      	
	      	
	      	<li>
	           <a href="https://github.com/ouvens" title="Fork me on GitHub">
	               <i class="icon-font i-heart"></i>
	               <span class="username">ouvens</span>
	           </a>
	        </li>
	      	
      	

      </ul>
    </div>
    <div class="site-signature">
    	<p class="rss-subscribe text"><strong>订阅<a href="/feed.xml">via RSS</a></strong></p>
      <p class="text">极限前端, 极限前端社区, ouven的博客, ouvenzhang的博客, www.jixianqianduan.com, github地址, 前端技术, 讲述前端高效技术与前沿。</p>
    </div>
  </div>
</footer>

<!-- Scripts -->
<script src="//1.url.cn/jslib/jquery/1.9.1/jquery.min.js" defer></script>

<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js" defer></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/lightbox2/2.7.1/js/lightbox.min.js" defer></script>

<script src="/assets/js/main.js" defer></script>

    </body>
</html>
