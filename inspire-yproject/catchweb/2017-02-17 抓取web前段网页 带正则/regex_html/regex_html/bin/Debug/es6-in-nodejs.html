<!DOCTYPE html>
<html>
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="google-site-verification" content="0FNbiBWk1FugWYo-RiGxQyIHebGeLoXp3HB7AxIFKy8" />
    <meta name="baidu-site-verification" content="tYoUqpkCCv" />
    <meta name="baidu-site-verification" content="IGN97NW90O" />
    
    <title>Nodejs下的ES6兼容性与性能分析 | ouvenzhang的博客</title>

    <meta http-equiv="x-dns-prefetch-control" content="on" />
    <link rel="dns-prefetch" href="cdnjs.cloudflare.com" />
    <link rel="dns-prefetch" href="1.url.cn" />

    <meta name="description" itemprop="description" content="Nodejs下的ES6兼容性与性能分析,es6,nodejs,兼容性 ">
    <meta itemprop="name" content="Nodejs下的ES6兼容性与性能分析">
    <meta itemprop="image" content="http://ouvens.github.io/blog/assets/logo.png">
    <meta itemprop="keywords" name="keywords" content="Nodejs下的ES6兼容性与性能分析,es6,nodejs,兼容性 ">

    
    <meta name="author" content="ouvenzhang">
    <meta name="copyright" content="&copy; ouvenzhang 2017">
    <meta name="protocol" content="1">
    

    <!-- External libraries -->
    <link rel="stylesheet" href="/assets/css/iconfont.css">
    <link rel="stylesheet" href="/css/monokai_sublime.css">

    <!-- Favicon and other icons (made with http://www.favicon-generator.org/) -->
    <link rel="shortcut icon" href="/assets/favicon.ico" type="image/x-icon">
  	<link rel="icon" href="/assets/favicon.ico" type="image/x-icon">
    
  	<meta name="msapplication-TileColor" content="#ffffff">
  	<meta name="theme-color" content="#ffffff">
    <meta name="msapplication-TileImage" content="/assets/icons/icon.png">

  	<!-- Site styles -->
    <link rel="stylesheet" href="/css/main.css">

    <link rel="alternate" type="application/rss+xml" title="极限前端" href="http://ouvens.github.io//feed.xml" />
    <script>
    // 访问统计
    var domain = 'jixianqianduan.com';
    var oldDomain = 'ouvens.github.io';
    if(location.host === domain){
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "//hm.baidu.com/hm.js?b536b128dc21c3d18fdc028f0609e3f0";
          var s = document.getElementsByTagName("script")[0]; 
          s.parentNode.insertBefore(hm, s);
        })();
    }else if(location.host === oldDomain){
        window.location.href = location.href.replace(oldDomain, domain);
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "//hm.baidu.com/hm.js?041efd2cb345ca1b9dbdbb2383cb716d";
          var s = document.getElementsByTagName("script")[0]; 
          s.parentNode.insertBefore(hm, s);
        })();
    }

    // 链接提交

    if(location.protocol === 'https'){
        !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=window.location.href,t=document.referrer;if(!e.test(r)){var o="https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif";t?(o+="?r="+encodeURIComponent(document.referrer),r&&(o+="&l="+r)):r&&(o+="?l="+r);var i=new Image;i.src=o}}(window);
    }else{
        !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=window.location.href,o=document.referrer;if(!e.test(r)){var n="//api.share.baidu.com/s.gif";o?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var t=new Image;t.src=n}}(window);
    }


    </script>
</head>

    <body>
        <div class="navigation" role="banner">
    <div class="navigation-wrapper">
    <a href="/" class="logo">
    	
      <img src="/assets/logo.png" alt="极限前端">
      
    </a>
    <span class="search-input" id="search-input">
      <input type="text" value="" class="search-text" placeholder="输入搜索关键字">
      <i class="icon-font i-search search-btn"></i>
    </span>
    <a href="javascript:void(0)" class="navigation-menu-button" id="js-mobile-menu">
    	<i class="icon-font i-list fa fa-bars"></i>
    </a>
    <span class="nav" role="navigation">
      <ul id="js-navigation-menu" class="navigation-menu show">
      	
          
          <li class="nav-link">
            <a href="/about/">关于</a>
          </li>
          
        
          
        
          
        
          
        
          
          <li class="nav-link">
            <a href="/category/">所有文章</a>
          </li>
          
        
          
          <li class="nav-link">
            <a href="/tags/">标签分类</a>
          </li>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          <li id="github-info" class="nav-link" title="https://github.com/ouvens">
            <a class="github-info" href="https://github.com/ouvens" target="_blank">
            <img src="/assets/github.png" height="34" width="130" alt="github地址"></a>
          </li>
      </ul>
    </span>
  </div>
</div>

            <div class="page-content">
        <div class="post">
<div class="post-header-container has-cover">
	<header class="post-header">
	  <h1 class="title">Nodejs下的ES6兼容性与性能分析</h1>
	  <p class="info">by <strong>ouven</strong></p>
	</header>
</div>
<div class="wrapper">



<div class="post-meta">
	<div class="post-date">2015年12月06日</div>
	<div class="post-categories">
	 in  
		<a target="_blank" href="/category/?cate=frontend-javascript">Frontend-javascript</a>
	  
	</div>
</div>	

<article class="post-content">
  <p>ES6标准发布后，前端人员也开发渐渐了解到了es6，但是由于兼容性的问题，仍然没有得到广泛的推广，不过业界也用了一些折中性的方案来解决兼容性和开发体系问题，但大家仍很疑惑，使用ES6会有哪些兼容性问题。</p>

<h4 id="nodejses6">一、Nodejs下ES6兼容性现状</h4>
<p>  之前写了es6通过Babel编译后的在浏览器端的兼容性问题<a href="http://ouvens.github.io/frontend-javascript/2015/10/16/es6-under-babel.html">《Babel下的ES6兼容性和规范》</a>，随着范围的扩展，ES6在Nodejs上兼容性也有必要重新梳理下。</p>

<p>  随着iojs的引入，新版的Nodejs开始原生支持部分ES6的特性，既然ES6在浏览器端使用需要使用babel等编译，在Nodejs总可以放心使用了吧。然而事实并非如此，为此在nodejs端，我也做了特性兼容性研究：</p>

<p><strong>ES6新特性在Nodejs下的兼容性列表</strong>
这里罗列下nodejs支持的新特性，没列出的新特性均为不支持。</p>

<p>https://iojs.org/en/es6.html</p>

<p>https://kangax.github.io/compat-table/es6/</p>

<table>
  <thead>
    <tr>
      <th>ES6特性</th>
      <th>Nodejs兼容性</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>let,const,块</td>
      <td>strict模式支持</td>
    </tr>
    <tr>
      <td>class类</td>
      <td>strict模式支持</td>
    </tr>
    <tr>
      <td>Map，Set 和 WeakMap，WeakSet</td>
      <td>支持</td>
    </tr>
    <tr>
      <td>generators</td>
      <td>支持</td>
    </tr>
    <tr>
      <td>进制转换</td>
      <td>支持</td>
    </tr>
    <tr>
      <td>对象字面量扩展</td>
      <td>支持</td>
    </tr>
    <tr>
      <td>promise</td>
      <td>支持</td>
    </tr>
    <tr>
      <td>String对象新API</td>
      <td>支持</td>
    </tr>
    <tr>
      <td>symbols</td>
      <td>支持</td>
    </tr>
    <tr>
      <td>字符串模板</td>
      <td>支持</td>
    </tr>
  </tbody>
</table>

<p>可见，es6的新特性在Nodejs中比babel还要差，而新版的babel已经能够支持es6的90%新特性了~</p>

<h4 id="nodejs-es6">二、Nodejs ES6性能分析</h4>
<p>  尽管目前Node下使用ES6我们仍然会大失所望，但es6发展的趋势定是必然，这里还是有必要对ES6的原生性能做了详细的对比测试。测试基本方法：</p>

<p><strong>1，对于重复操作循环执行100万次</strong></p>

<p><strong>2，所有程序运行在Nodejs下执行</strong></p>

<p><strong>3，环境描述</strong></p>

<ul>
  <li>
    <p>CPU： Interl(R) Core(Tm) i5-3470 CPU @ 3.2GHz</p>
  </li>
  <li>
    <p>内存：4.00GB</p>
  </li>
  <li>
    <p>操作系统： 64位操作系统</p>
  </li>
  <li>
    <p>node版本：node v5.1.1</p>
  </li>
</ul>

<p><strong>2.1、let, const, 块</strong></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17</pre></td><td class="code"><pre>
<span class="s1">'use strict'</span>
<span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">t1</span> <span class="o">=</span> <span class="o">+</span><span class="k">new</span> <span class="nb">Date</span><span class="p">(),</span>
    <span class="nx">t2</span><span class="p">;</span>

<span class="k">while</span><span class="p">(</span><span class="nx">i</span><span class="o">++</span> <span class="o">&lt;</span> <span class="mi">1000000</span><span class="p">){</span>
    <span class="kr">const</span> <span class="nx">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="kr">const</span> <span class="nx">b</span> <span class="o">=</span> <span class="s1">'1'</span><span class="p">;</span>
    <span class="kr">const</span> <span class="nx">c</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="kr">const</span> <span class="nx">d</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="kr">const</span> <span class="nx">e</span> <span class="o">=</span> <span class="p">[];</span>
<span class="p">}</span>

<span class="nx">t2</span> <span class="o">=</span> <span class="o">+</span><span class="k">new</span> <span class="nb">Date</span><span class="p">()</span> <span class="o">-</span> <span class="nx">t1</span><span class="p">;</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">t2</span><span class="p">);</span>

</pre></td></tr></tbody></table>
</div>
</div>

<table>
  <thead>
    <tr>
      <th>运行次数</th>
      <th>ES5运行时间</th>
      <th>ES6运行时间</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>100万</td>
      <td>52-53ms</td>
      <td>33-34ms</td>
    </tr>
  </tbody>
</table>

<p>结果让我震惊了，使用let，const声明变量的速度竟然比var快了约65%左右。原因可能是使用var会去检查作用域上的同名变量，而使用let或const不用考虑。</p>

<p><strong>2.2、class类使用</strong></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></td><td class="code"><pre>
<span class="s1">'use strict'</span>
<span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">t1</span> <span class="o">=</span> <span class="o">+</span><span class="k">new</span> <span class="nb">Date</span><span class="p">(),</span>
    <span class="nx">t2</span><span class="p">;</span>

<span class="k">while</span><span class="p">(</span><span class="nx">i</span><span class="o">++</span> <span class="o">&lt;</span> <span class="mi">100000</span><span class="p">){</span>
    <span class="kr">class</span> <span class="nx">A</span><span class="p">{</span>
        <span class="nx">constructor</span><span class="p">()</span> <span class="p">{</span>
           <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s1">'ouven'</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">getName</span><span class="p">(){</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kr">const</span> <span class="nx">a</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">A</span><span class="p">();</span>
    <span class="nx">a</span><span class="p">.</span><span class="nx">getName</span><span class="p">();</span>
<span class="p">}</span>

<span class="nx">t2</span> <span class="o">=</span> <span class="o">+</span><span class="k">new</span> <span class="nb">Date</span><span class="p">()</span> <span class="o">-</span> <span class="nx">t1</span><span class="p">;</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">t2</span><span class="p">);</span>

</pre></td></tr></tbody></table>
</div>
</div>

<table>
  <thead>
    <tr>
      <th>运行次数</th>
      <th>ES5运行时间</th>
      <th>ES6运行时间</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>10万</td>
      <td>1179-1211ms</td>
      <td>1411-1442ms</td>
    </tr>
  </tbody>
</table>

<p>可见使用Nodejs的Class比ES的function构造方法慢约25%</p>

<p><strong>2.3、Map，Set 和 WeakMap，WeakSet</strong></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16</pre></td><td class="code"><pre>
<span class="s1">'use strict'</span>
<span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">t1</span> <span class="o">=</span> <span class="o">+</span><span class="k">new</span> <span class="nb">Date</span><span class="p">(),</span>
    <span class="nx">t2</span><span class="p">;</span>

<span class="k">while</span><span class="p">(</span><span class="nx">i</span><span class="o">++</span> <span class="o">&lt;</span> <span class="mi">1000000</span><span class="p">){</span>
    
    <span class="kd">let</span> <span class="nx">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Map</span><span class="p">();</span>
    <span class="nx">map</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'key'</span><span class="p">,</span><span class="s1">'value'</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">t2</span> <span class="o">=</span> <span class="o">+</span><span class="k">new</span> <span class="nb">Date</span><span class="p">()</span> <span class="o">-</span> <span class="nx">t1</span><span class="p">;</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">t2</span><span class="p">);</span>


</pre></td></tr></tbody></table>
</div>
</div>

<table>
  <thead>
    <tr>
      <th>运行次数</th>
      <th>ES5运行时间</th>
      <th>ES6运行时间</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>100万</td>
      <td>11-13ms</td>
      <td>179-180ms</td>
    </tr>
  </tbody>
</table>

<p>测试结果看，Map的效率相对普通的对象key-value的结果相比慢的多，但是Map的Key可以使负责类型，这里的参考性也就不是绝对准确。建议是不到必须情况，不要使用Map等复杂类型。Set、WeakMap、WeakSet均相对object结构执行效率慢得多。</p>

<p><strong>2.4、字符串模板</strong></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21</pre></td><td class="code"><pre>
<span class="s1">'use strict'</span>
<span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">t1</span> <span class="o">=</span> <span class="o">+</span><span class="k">new</span> <span class="nb">Date</span><span class="p">(),</span>
    <span class="nx">t2</span><span class="p">;</span>

<span class="kd">let</span> <span class="nx">vars</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">name</span><span class="p">:</span> <span class="s1">'ouven'</span><span class="p">,</span>
    <span class="na">address</span><span class="p">:</span> <span class="s1">'tencent'</span>
<span class="p">};</span>

<span class="k">while</span><span class="p">(</span><span class="nx">i</span><span class="o">++</span> <span class="o">&lt;</span> <span class="mi">1000000</span><span class="p">){</span>

    <span class="kd">let</span> <span class="nx">str</span> <span class="o">=</span> <span class="err">`</span><span class="nx">string</span> <span class="nx">text</span> <span class="nx">$</span><span class="p">{</span><span class="nx">vars</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span> <span class="nx">string</span> <span class="nx">$</span><span class="p">{</span><span class="nx">vars</span><span class="p">.</span><span class="nx">address</span><span class="p">}</span><span class="err">`</span><span class="p">;</span>
    
<span class="p">}</span>

<span class="nx">t2</span> <span class="o">=</span> <span class="o">+</span><span class="k">new</span> <span class="nb">Date</span><span class="p">()</span> <span class="o">-</span> <span class="nx">t1</span><span class="p">;</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">t2</span><span class="p">);</span>


</pre></td></tr></tbody></table>
</div>
</div>

<table>
  <thead>
    <tr>
      <th>运行次数</th>
      <th>ES5运行时间</th>
      <th>ES6运行时间</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>100万</td>
      <td>8ms</td>
      <td>59-61ms</td>
    </tr>
  </tbody>
</table>

<p>ES6的字符串模板看起来很好，但是由于执行时必须扫描这个串，找出里面的模板变量，所以整体上性能就相对ES5的字符串拼接慢了很多。</p>

<p>其它的特性实现有兴趣的同学可以自己继续研究。相信结果大概可以预测到。</p>

<p><a href="https://github.com/ouvens/demo-file/tree/master/es6-performance-test">测试用例代码地址</a></p>

<h4 id="section">三、小结</h4>

<p>  这里选择了ES6中的少数特性和ES5的实现的执行效率做了对比，整体上说，ES6的新特性相对ES5的实现效率慢些，而有些特性当然是ES5无法实现的。所以在了解使用ES6的同时，除了了解它的新特性和优点，对于ES6本身的一些问题也要做到心中有数。当然，随着ES6的完善和Node的更新，相信这些也不会是大的问题，而且这些也不会影响ES6的发展。</p>

<p>  https://github.com/ouvens/es6-code-style-guide</p>

</article>


<div class="tags">
	<strong>Tags:</strong> <a target="_blank" href="/tags/?tag=es6">es6</a>,&nbsp;<a target="_blank" href="/tags/?tag=nodejs">nodejs</a>,&nbsp;<a target="_blank" href="/tags/?tag=兼容性">兼容性</a>
</div>


	<script src="/assets/js/github.comment.js"></script>
	<div class="gc-comments" data-repos="ouvens/ouvens.github.io" data-issues="3" >
	    <div class="gc-comments-title">
	        评论
	    </div>
	    <div class="gc-comments-info">
	        想在此留下评论，请访问 <a href="issues_link">issues_link</a> 提交评论
	    </div>
	</div>
</div>
</div>


    </div>
    
<div class="qr-code qr-code-pay" title="加个微信交流交流">
    <img src="/assets/qrcode/qr-code-person.jpg" width="200" height="200" alt="公众号">
    <p>加我赏红包，哈哈哈</p>
</div>

<div class="qr-code qr-code-wx" title="定期获取更新动态">
    <img src="/assets/qrcode/qrcode.jpg" width="200" height="200" alt="公众号">
    <p>欢迎关注 <strong>极限前端</strong> 公众号</p>
</div>


    
<footer class="site-footer">
  <div class="wrapper">
    <h3 class="footer-heading">极限前端</h3>
    <div class="site-navigation">
    	<p><strong>站内</strong></p>
      <ul class="pages">
        
        
          <li class="nav-link"><a href="/about/">关于</a>
        
        
        
        
        
        
        
        
        
          <li class="nav-link"><a href="/category/">所有文章</a>
        
        
        
          <li class="nav-link"><a href="/tags/">标签分类</a>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
      </ul>
    </div>
    <div class="site-contact">
    	<p><strong>相关链接</strong></p>
        <ul class="social-media-list">
      	<li>
      		<a href="mailto:1025224452@qq.com">
	      		<i class="icon-font i-star"></i>
	      		<span class="username">1025224452@qq.com</span>
      		</a>
      	</li>

      	
	      	
	      	<li>
	           <a href="https://github.com/ouvens" title="Fork me on GitHub">
	               <i class="icon-font i-heart"></i>
	               <span class="username">ouvens</span>
	           </a>
	        </li>
	      	
      	

      </ul>
    </div>
    <div class="site-signature">
    	<p class="rss-subscribe text"><strong>订阅<a href="/feed.xml">via RSS</a></strong></p>
      <p class="text">极限前端, 极限前端社区, ouven的博客, ouvenzhang的博客, www.jixianqianduan.com, github地址, 前端技术, 讲述前端高效技术与前沿。</p>
    </div>
  </div>
</footer>

<!-- Scripts -->
<script src="//1.url.cn/jslib/jquery/1.9.1/jquery.min.js" defer></script>

<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js" defer></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/lightbox2/2.7.1/js/lightbox.min.js" defer></script>

<script src="/assets/js/main.js" defer></script>

    </body>
</html>
