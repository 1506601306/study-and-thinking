<!DOCTYPE html>
<html>
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="google-site-verification" content="0FNbiBWk1FugWYo-RiGxQyIHebGeLoXp3HB7AxIFKy8" />
    <meta name="baidu-site-verification" content="tYoUqpkCCv" />
    <meta name="baidu-site-verification" content="IGN97NW90O" />
    
    <title>fis3试用与构建配置研究 | ouvenzhang的博客</title>

    <meta http-equiv="x-dns-prefetch-control" content="on" />
    <link rel="dns-prefetch" href="cdnjs.cloudflare.com" />
    <link rel="dns-prefetch" href="1.url.cn" />

    <meta name="description" itemprop="description" content="fis3试用与构建配置研究,fis3 ">
    <meta itemprop="name" content="fis3试用与构建配置研究">
    <meta itemprop="image" content="http://ouvens.github.io/blog/assets/logo.png">
    <meta itemprop="keywords" name="keywords" content="fis3试用与构建配置研究,fis3 ">

    
    <meta name="author" content="ouvenzhang">
    <meta name="copyright" content="&copy; ouvenzhang 2017">
    <meta name="protocol" content="1">
    

    <!-- External libraries -->
    <link rel="stylesheet" href="/assets/css/iconfont.css">
    <link rel="stylesheet" href="/css/monokai_sublime.css">

    <!-- Favicon and other icons (made with http://www.favicon-generator.org/) -->
    <link rel="shortcut icon" href="/assets/favicon.ico" type="image/x-icon">
  	<link rel="icon" href="/assets/favicon.ico" type="image/x-icon">
    
  	<meta name="msapplication-TileColor" content="#ffffff">
  	<meta name="theme-color" content="#ffffff">
    <meta name="msapplication-TileImage" content="/assets/icons/icon.png">

  	<!-- Site styles -->
    <link rel="stylesheet" href="/css/main.css">

    <link rel="alternate" type="application/rss+xml" title="极限前端" href="http://ouvens.github.io//feed.xml" />
    <script>
    // 访问统计
    var domain = 'jixianqianduan.com';
    var oldDomain = 'ouvens.github.io';
    if(location.host === domain){
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "//hm.baidu.com/hm.js?b536b128dc21c3d18fdc028f0609e3f0";
          var s = document.getElementsByTagName("script")[0]; 
          s.parentNode.insertBefore(hm, s);
        })();
    }else if(location.host === oldDomain){
        window.location.href = location.href.replace(oldDomain, domain);
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "//hm.baidu.com/hm.js?041efd2cb345ca1b9dbdbb2383cb716d";
          var s = document.getElementsByTagName("script")[0]; 
          s.parentNode.insertBefore(hm, s);
        })();
    }

    // 链接提交

    if(location.protocol === 'https'){
        !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=window.location.href,t=document.referrer;if(!e.test(r)){var o="https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif";t?(o+="?r="+encodeURIComponent(document.referrer),r&&(o+="&l="+r)):r&&(o+="?l="+r);var i=new Image;i.src=o}}(window);
    }else{
        !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=window.location.href,o=document.referrer;if(!e.test(r)){var n="//api.share.baidu.com/s.gif";o?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var t=new Image;t.src=n}}(window);
    }


    </script>
</head>

    <body>
        <div class="navigation" role="banner">
    <div class="navigation-wrapper">
    <a href="/" class="logo">
    	
      <img src="/assets/logo.png" alt="极限前端">
      
    </a>
    <span class="search-input" id="search-input">
      <input type="text" value="" class="search-text" placeholder="输入搜索关键字">
      <i class="icon-font i-search search-btn"></i>
    </span>
    <a href="javascript:void(0)" class="navigation-menu-button" id="js-mobile-menu">
    	<i class="icon-font i-list fa fa-bars"></i>
    </a>
    <span class="nav" role="navigation">
      <ul id="js-navigation-menu" class="navigation-menu show">
      	
          
          <li class="nav-link">
            <a href="/about/">关于</a>
          </li>
          
        
          
        
          
        
          
        
          
          <li class="nav-link">
            <a href="/category/">所有文章</a>
          </li>
          
        
          
          <li class="nav-link">
            <a href="/tags/">标签分类</a>
          </li>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          <li id="github-info" class="nav-link" title="https://github.com/ouvens">
            <a class="github-info" href="https://github.com/ouvens" target="_blank">
            <img src="/assets/github.png" height="34" width="130" alt="github地址"></a>
          </li>
      </ul>
    </span>
  </div>
</div>

            <div class="page-content">
        <div class="post">
<div class="post-header-container has-cover">
	<header class="post-header">
	  <h1 class="title">fis3试用与构建配置研究</h1>
	  <p class="info">by <strong>ouven</strong></p>
	</header>
</div>
<div class="wrapper">



<div class="post-meta">
	<div class="post-date">2015年08月15日</div>
	<div class="post-categories">
	 in  
		<a target="_blank" href="/category/?cate=frontend-build">Frontend-build</a>
	  
	</div>
</div>	

<article class="post-content">
  <h3 id="section">一、安装</h3>

<ul>
  <li>安装初始化</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre>npm i -g fis3
fis3 -v
fis3 init
</pre></td></tr></tbody></table>
</div>
</div>

<h3 id="section-1">二、配置</h3>

<p>类似Gruntfile.js或Gulpfile.js，新建fis-config.js文件
配置api介绍如下：</p>

<h4 id="fissetkey-value">fis.set(key, value)</h4>

<p>设置一些配置，如系统内置属性 project、namespace、modules、settings。 fis.set 设置的值通过fis.get()获取</p>

<h4 id="fisgetkey">fis.get(key)</h4>

<p>获取已经配置的属性，和 fis.set() 成对使用</p>

<h4 id="fismatchselector-props--important">fis.match(selector, props, [, important])</h4>

<p>给匹配到的文件分配属性，文件属性决定了这个文件进行怎么样的操作；fis.match 模拟一个类似 css 的覆盖规则，负责给文件分配规则属性，这些规则属性决定了这个文件将会被如何处理；另外，后面分配到的规则会覆盖前面的；</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7</pre></td><td class="code"><pre><span class="nx">fis</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="s1">'{a,b}.js'</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">release</span><span class="p">:</span> <span class="s1">'/static/\$0'</span>
<span class="p">});</span>

<span class="nx">fis</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="s1">'b.js'</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">release</span><span class="p">:</span> <span class="s1">'/static/new/\$0'</span>
<span class="p">});</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>这里b.js的输出为 /static/new/$0，如果important为true则规则不能被覆盖</p>

<h4 id="fismediamode">fis.media(mode)</h4>

<p>fis.media 是模仿自 css 的 @media，表示不同的状态。这是 fis3 中的一个重要概念，其意味着有多份配置，每一份配置都可以让 fis3 进行不同的编译；</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7</pre></td><td class="code"><pre><span class="nx">fis</span><span class="p">.</span><span class="nx">media</span><span class="p">(</span><span class="s1">'dev'</span><span class="p">).</span><span class="nx">match</span><span class="p">(</span><span class="s1">'*.js'</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">optimizer</span><span class="p">:</span> <span class="kc">null</span>
<span class="p">});</span>
 
<span class="nx">fis</span><span class="p">.</span><span class="nx">media</span><span class="p">(</span><span class="s1">'rd'</span><span class="p">).</span><span class="nx">match</span><span class="p">(</span><span class="s1">'*.js'</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">domain</span><span class="p">:</span> <span class="s1">'http://rd-host/static/cdn'</span>
<span class="p">});</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="fispluginname-props--place">fis.plugin(name, [props, [, place]])</h4>

<p>http://fis.baidu.com/fis3/docs/api/config-api.html#%E5%85%A8%E5%B1%80%E5%B1%9E%E6%80%A7</p>

<h4 id="section-2">几种重要属性设置</h4>

<ol>
  <li>全局属性介绍：</li>
</ol>

<div class="language-javascript highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></td><td class="code"><pre><span class="kd">var</span> <span class="nx">DEFAULT_SETTINGS</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">project</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">charset</span><span class="p">:</span> <span class="s1">'utf8'</span><span class="p">,</span>    <span class="c1">//字符编码，@param: string</span>
    <span class="na">md5Length</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>    <span class="c1">//md5长度， @param: number</span>
    <span class="na">md5Connector</span><span class="p">:</span> <span class="s1">'_'</span><span class="p">,</span>    <span class="c1">//设置md5与文件的连接字符，@param: string</span>
    <span class="na">files</span><span class="p">:</span> <span class="p">[</span><span class="s1">'**'</span><span class="p">],</span>    <span class="c1">//设置项目源码文件过滤器，@param:</span>
    <span class="na">ignore</span><span class="p">:</span> <span class="p">[</span><span class="s1">'node_modules/**'</span><span class="p">,</span> <span class="s1">'output/**'</span><span class="p">,</span> <span class="s1">'.git/**'</span><span class="p">,</span> <span class="s1">'fis-conf.js'</span><span class="p">]</span>    <span class="c1">//排除某些不处理的文件</span>
    <span class="na">fileType</span><span class="p">:{</span>
        <span class="na">text</span><span class="p">:</span> <span class="p">[</span><span class="s1">'html'</span><span class="p">,</span> <span class="s1">'js'</span><span class="p">],</span>    <span class="c1">//追加文本文件后缀列表，@param: array | string</span>
        <span class="na">image</span><span class="p">:</span> <span class="p">[</span><span class="s1">'png'</span><span class="p">]</span>    <span class="c1">//最佳图片类二进制文件后缀列表，@param: array | string</span>
    <span class="p">}</span>
  <span class="p">},</span>

    <span class="c1">// project的属性也可以通过 fis.set('project.charset', 'utf8') 来设置，其它的类似</span>
 
  <span class="na">component</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">skipRoadmapCheck</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>  
    <span class="na">protocol</span><span class="p">:</span> <span class="s1">'github'</span><span class="p">,</span>
    <span class="na">author</span><span class="p">:</span> <span class="s1">'fis-components'</span>
  <span class="p">},</span>
 
  <span class="na">modules</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">hook</span><span class="p">:</span> <span class="s1">'components'</span><span class="p">,</span>
    <span class="na">packager</span><span class="p">:</span> <span class="s1">'map'</span>
  <span class="p">},</span>
 
  <span class="na">options</span><span class="p">:</span> <span class="p">{}</span>
<span class="p">};</span>
</pre></td></tr></tbody></table>
</div>
</div>

<ol>
  <li>文件属性：</li>
</ol>

<div class="language-javascript highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40</pre></td><td class="code"><pre><span class="nx">fis</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'timeDate'</span><span class="p">,</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">());</span>    <span class="c1">//获取当前时间戳</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="s1">'/widget/{*,**/*}.js'</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">charset</span><span class="p">:</span> <span class="s1">'utf8'</span><span class="p">,</span>    <span class="c1">//指定文本文件的输出编码。@param: string</span>
    <span class="na">url</span><span class="p">:</span> <span class="s1">'/static/proj/pkg_widget.js'</span><span class="p">,</span> <span class="c1">//指定文件的资源定位路径，以 / 开头。默认是 release 的值，url可以与发布路径 release 不一致。@param: string</span>
    <span class="na">release</span><span class="p">:</span> <span class="s1">'/static/$0'</span><span class="p">,</span>    <span class="c1">//设置文件的产出路径。设置为false表示不生成文件,@param: string</span>
    <span class="na">packTo</span><span class="p">:</span> <span class="s1">'/static/pkg_widget.js'</span><span class="p">,</span>     <span class="c1">//分配到这个属性的文件将会合并到这个属性配置的文件中,@param: string</span>
    <span class="na">query</span><span class="p">:</span> <span class="s1">'?=t'</span> <span class="o">+</span> <span class="nx">fis</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'timeDate'</span><span class="p">),</span>    <span class="c1">//指定文件的资源定位路径之后的query，比如'?t=123124132'。@param: string</span>
    <span class="na">isHtmlLike</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>     <span class="c1">//指定对文件进行 html 相关语言能力处理.@param: bool</span>
    <span class="na">isCssLike</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>     <span class="c1">//指定对文件进行 css 相关的语言能力处理.@param: bool</span>
    <span class="na">isJsLike</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>    <span class="c1">//指定对文件进行 js 相关的语言能力处理</span>
    <span class="na">useSameNameRequire</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>    <span class="c1">//开启同名依赖.@param: bool</span>
    <span class="na">requires</span><span class="p">:[</span>    <span class="c1">//默认依赖的资源id表</span>
        <span class="s1">''</span><span class="kr">static</span><span class="o">/</span><span class="nx">lib</span><span class="o">/</span><span class="nx">jquery</span><span class="p">.</span><span class="nx">js</span><span class="s1">''</span>
    <span class="p">],</span>
    <span class="na">extras</span><span class="p">:</span> <span class="p">{</span>    <span class="c1">//在[静态资源映射表][]中的附加数据，用于扩展[静态资源映射表][]表的功能。@param: object</span>
        <span class="na">isPage</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="nx">fis</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="s1">'/widget/mod.js'</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">packOrder</span><span class="p">:</span> <span class="o">-</span><span class="mi">100</span><span class="p">,</span>     <span class="c1">//用来控制合并时的顺序，值越小越在前面。配合 packTo 一起使用。@param:number</span>
<span class="p">});</span>

<span class="nx">fis</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="s1">'/widget/jquery.js'</span><span class="p">,</span> <span class="p">{</span>
    <span class="c1">//使用 var $ = require('jquery');</span>
    <span class="na">id</span><span class="p">:</span> <span class="s1">'query'</span><span class="p">,</span>    <span class="c1">//指定文件的资源id。默认是 namespace + subpath 的值,@param: string</span>
    <span class="na">moduleId</span><span class="p">:</span> <span class="s1">'jquery'</span><span class="p">,</span>    <span class="c1">//指定文件资源的模块id。在插件fis3-hook-module里面自动包裹define的时候会用到，默认是 id 的值。@param: string</span>
    <span class="na">isMod</span><span class="p">:</span> <span class="kc">true</span>    <span class="c1">//标示文件是否为组件化文件。@param: bool</span>
<span class="p">});</span>

<span class="nx">fis</span><span class="p">.</span><span class="nx">media</span><span class="p">(</span><span class="s1">'prod'</span><span class="p">).</span><span class="nx">match</span><span class="p">(</span><span class="s1">'*.css'</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">useHash</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>     <span class="c1">//是否携带md5戳。@param: true</span>
    <span class="na">domain</span><span class="p">:</span> <span class="s1">'http://www.qq.com'</span><span class="p">,</span>   <span class="c1">//给文件 URL 设置cdn替换前缀。@paran: string</span>
<span class="p">});</span>

<span class="nx">fis</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="s1">'*.less'</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">rExt</span><span class="p">:</span> <span class="s1">'.css'</span>    <span class="c1">//设置最终文件产出后的后缀.@param: string</span>
    <span class="na">userMap</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>    <span class="c1">//文件信息是否添加到 map.json,用于处理声明依赖，后面会讲到。@param: bool</span>
    
<span class="p">});</span>
</pre></td></tr></tbody></table>
</div>
</div>

<ol>
  <li>插件配置属性：</li>
</ol>

<div class="language-javascript highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></td><td class="code"><pre><span class="nx">fis</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="s1">'*.js'</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">lint</span><span class="p">:</span> <span class="nx">fis</span><span class="p">.</span><span class="nx">plugin</span><span class="p">(</span><span class="s1">'js'</span><span class="p">,</span> <span class="p">{</span>    <span class="c1">//启用 lint 插件进行代码检查</span>
 
    <span class="p">});</span>
<span class="p">});</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="s1">'*.less'</span><span class="p">,</span> <span class="p">{</span>
   <span class="na">parser</span><span class="p">:</span> <span class="nx">fis</span><span class="p">.</span><span class="nx">plugin</span><span class="p">(</span><span class="s1">'less'</span><span class="p">),</span> <span class="c1">//启用fis-parser-less插件</span>
   <span class="na">rExt</span><span class="p">:</span> <span class="s1">'.css'</span>
<span class="p">});</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="s1">'*.sass'</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">parser</span><span class="p">:</span> <span class="nx">fis</span><span class="p">.</span><span class="nx">plugin</span><span class="p">(</span><span class="s1">'sass'</span><span class="p">),</span> <span class="c1">//启用fis-parser-sass插件</span>
    <span class="na">rExt</span><span class="p">:</span> <span class="s1">'.css'</span>
<span class="p">});</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="s1">'*.{css,less}'</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">paser</span><span class="p">:</span> <span class="nx">fis</span><span class="p">.</span><span class="nx">plugin</span><span class="p">(</span><span class="s1">'image-set'</span><span class="p">)</span>
<span class="p">});</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="s1">'::package'</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">packager</span><span class="p">:</span> <span class="nx">fis</span><span class="p">.</span><span class="nx">plugin</span><span class="p">(</span><span class="s1">'map'</span><span class="p">),</span>
    <span class="na">spriter</span><span class="p">:</span> <span class="nx">fis</span><span class="p">.</span><span class="nx">plugin</span><span class="p">(</span><span class="s1">'csssprites'</span><span class="p">)</span>
<span class="p">});</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">media</span><span class="p">(</span><span class="s1">'prod'</span><span class="p">).</span><span class="nx">match</span><span class="p">(</span><span class="s1">'::package'</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">spriter</span><span class="p">:</span> <span class="nx">fis</span><span class="p">.</span><span class="nx">plugin</span><span class="p">(</span><span class="s1">'csssprites'</span><span class="p">)</span>
<span class="p">});</span>
<span class="c1">// 发布部署等</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="s1">'**'</span><span class="p">,</span> <span class="p">{</span>
      <span class="na">deploy</span><span class="p">:</span> <span class="nx">fis</span><span class="p">.</span><span class="nx">plugin</span><span class="p">(</span><span class="s1">'http-push'</span><span class="p">,</span> <span class="p">{</span>
          <span class="na">receiver</span><span class="p">:</span> <span class="s1">'http://target-host/receiver.php'</span><span class="p">,</span> <span class="c1">// 接收端</span>
          <span class="na">to</span><span class="p">:</span> <span class="s1">'/home/work/www'</span> <span class="c1">// 将部署到服务器的这个目录下</span>
      <span class="p">})</span>
  <span class="p">})</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>当然更多插件可以查看 http://npmsearch.com/?q=fis-parser%20fis3-parser
通过插件我们就可以使用一些基础功能的组合了：</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></td><td class="code"><pre><span class="c1">// 加 md5</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="s1">'*.{js,css,png}'</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">useHash</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">});</span>
 
<span class="c1">// 启用 fis-spriter-csssprites 插件</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="s1">'::package'</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">spriter</span><span class="p">:</span> <span class="nx">fis</span><span class="p">.</span><span class="nx">plugin</span><span class="p">(</span><span class="s1">'csssprites'</span><span class="p">)</span>
<span class="p">})</span>
 
<span class="c1">// 对 CSS 进行图片合并</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="s1">'*.css'</span><span class="p">,</span> <span class="p">{</span>
    <span class="c1">// 给匹配到的文件分配属性 `useSprite`</span>
    <span class="na">useSprite</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">});</span>
 
<span class="nx">fis</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="s1">'*.js'</span><span class="p">,</span> <span class="p">{</span>
     <span class="c1">// fis-optimizer-uglify-js 插件进行压缩，已内置</span>
    <span class="na">optimizer</span><span class="p">:</span> <span class="nx">fis</span><span class="p">.</span><span class="nx">plugin</span><span class="p">(</span><span class="s1">'uglify-js'</span><span class="p">)</span>
<span class="p">});</span>
 
<span class="nx">fis</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="s1">'*.css'</span><span class="p">,</span> <span class="p">{</span>
    <span class="c1">// fis-optimizer-clean-css 插件进行压缩，已内置</span>
    <span class="na">optimizer</span><span class="p">:</span> <span class="nx">fis</span><span class="p">.</span><span class="nx">plugin</span><span class="p">(</span><span class="s1">'clean-css'</span><span class="p">)</span>
<span class="p">});</span>
 
<span class="nx">fis</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="s1">'*.png'</span><span class="p">,</span> <span class="p">{</span>
    <span class="c1">// fis-optimizer-png-compressor 插件进行压缩，已内置</span>
    <span class="na">optimizer</span><span class="p">:</span> <span class="nx">fis</span><span class="p">.</span><span class="nx">plugin</span><span class="p">(</span><span class="s1">'png-compressor'</span><span class="p">)</span>
<span class="p">});</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>如果开发阶段有时不需要那么多处理流程可以禁用某些功能：</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre><span class="nx">fis</span><span class="p">.</span><span class="nx">media</span><span class="p">(</span><span class="s1">'debug'</span><span class="p">).</span><span class="nx">match</span><span class="p">(</span><span class="s1">'*.{js,css,png}'</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">useHash</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="na">useSprite</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="na">optimizer</span><span class="p">:</span> <span class="kc">null</span>
<span class="p">})</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h3 id="section-3">三、调试与发布</h3>

<p>FIS3 构建后，默认情况下会对资源的 URL 进行修改，改成绝对路径。同样FIS3 内置一个简易 Web Server，可以方便调试构建结果。</p>

<ul>
  <li>1、开启server到内置server调试目录</li>
</ul>

<div class="language-javascript highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre><span class="nx">fis3</span> <span class="nx">server</span> <span class="nx">open</span>
</pre></td></tr></tbody></table>
</div>
</div>

<ul>
  <li>2、发布到内置server发布目录</li>
</ul>

<div class="language-javascript highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre><span class="nx">fis3</span> <span class="nx">release</span>
</pre></td></tr></tbody></table>
</div>
</div>

<ul>
  <li>3、文件监听</li>
</ul>

<div class="language-javascript highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre><span class="nx">fis3</span> <span class="nx">release</span> <span class="o">-</span><span class="nx">w</span>    <span class="c1">//FIS3 通过对 release 命令添加 -w 或者 --watch 参数启动文件监听功能。</span>
<span class="nx">fis3</span> <span class="nx">release</span> <span class="o">-</span><span class="nx">wL</span>  <span class="c1">//文件修改自动构建发布了，如果浏览器能自动刷新。</span>
</pre></td></tr></tbody></table>
</div>
</div>

<ul>
  <li>4、发布配置
发布只需要配置就可以完成</li>
</ul>

<div class="language-javascript highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6</pre></td><td class="code"><pre><span class="nx">fis</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="s1">'*'</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">deploy</span><span class="p">:</span> <span class="nx">fis</span><span class="p">.</span><span class="nx">plugin</span><span class="p">(</span><span class="s1">'http-push'</span><span class="p">,</span> <span class="p">{</span>
        <span class="na">receiver</span><span class="p">:</span> <span class="s1">'http://cq.01.p.p.baidu.com:8888/receiver.php'</span><span class="p">,</span>
        <span class="na">to</span><span class="p">:</span> <span class="s1">'/home/work/htdocs'</span> <span class="c1">// 注意这个是指的是测试机器的路径，而非本地机器</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h3 id="section-4">四、内置功能</h3>

<ul>
  <li>4.1 嵌入资源</li>
</ul>

<p>html和css中内嵌只需要在引用加载的文件后面加上__inline就可实现:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7</pre></td><td class="code"><pre><span class="nt">&lt;img</span> <span class="na">title=</span><span class="s">"百度logo"</span> <span class="na">src=</span><span class="s">"images/logo.gif?__inline"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">type=</span><span class="s">"text/css"</span> <span class="na">href=</span><span class="s">"demo.css?__inline"</span><span class="nt">&gt;</span>
<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"demo.js?__inline"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"import"</span> <span class="na">href=</span><span class="s">"demo.html?__inline"</span><span class="nt">&gt;</span>

 @import url('demo.css?__inline');

</pre></td></tr></tbody></table>
</div>
</div>

<p>js中内嵌资源稍有点不同：</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre><span class="nx">__inline</span><span class="p">(</span><span class="s1">'demo.js'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">img</span> <span class="o">=</span> <span class="nx">__inline</span><span class="p">(</span><span class="s1">'images/logo.gif'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">css</span> <span class="o">=</span> <span class="nx">__inline</span><span class="p">(</span><span class="s1">'a.css'</span><span class="p">);</span>
</pre></td></tr></tbody></table>
</div>
</div>

<ul>
  <li>4.2 资源定位</li>
</ul>

<p>其实官方文档讲了很多，但很简单，主要是在没有inline的条件下将内嵌的资源处理后加上后缀，放入到相对应的发布目录中自动定位。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre><span class="kd">var</span> <span class="nx">img</span> <span class="o">=</span> <span class="nx">__uri</span><span class="p">(</span><span class="s1">'images/logo.gif'</span><span class="p">);</span>
<span class="c1">// 处理后变成，其它的原理类似</span>
<span class="kd">var</span> <span class="nx">img</span> <span class="o">=</span> <span class="s1">'/static/pic/logo_74e5229.gif'</span><span class="p">;</span>
</pre></td></tr></tbody></table>
</div>
</div>

<ul>
  <li>4.3 声明依赖</li>
</ul>

<p>html中声明依赖。用户可以在html的注释中声明依赖关系，这些依赖关系最终会被记录下来，当某个文件中包含字符 <strong>RESOURCE_MAP</strong> 那么这个记录会被字符串化后替换 <strong>RESOURCE_MAP</strong>。
例如index.html中含有并且设置了useMap：</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4</pre></td><td class="code"><pre><span class="c">&lt;!--</span>
    <span class="err">@</span><span class="nx">require</span> <span class="nx">demo</span><span class="p">.</span><span class="nx">js</span>
    <span class="err">@</span><span class="nx">require</span> <span class="s2">"demo.css"</span>
<span class="o">--&gt;</span>
</pre></td></tr></tbody></table>
</div>
</div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4</pre></td><td class="code"><pre><span class="c1">//fis-conf.js</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="s1">'*.html'</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">useMap</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">})</span>
</pre></td></tr></tbody></table>
</div>
</div>
<p>那么发布后会产生如下manifest.json文件：</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10</pre></td><td class="code"><pre><span class="p">{</span>
    <span class="s2">"res"</span> <span class="err">:</span> <span class="p">{</span>
        <span class="s2">"index.html"</span> <span class="err">:</span> <span class="p">{</span>
            <span class="s2">"uri"</span> <span class="err">:</span> <span class="s2">"/index.html"</span><span class="p">,</span>
            <span class="s2">"type"</span> <span class="err">:</span> <span class="s2">"html"</span><span class="p">,</span>
            <span class="s2">"deps"</span> <span class="err">:</span> <span class="p">[</span> <span class="s2">"demo.js"</span><span class="p">,</span> <span class="s2">"demo.css"</span> <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="s2">"pkg"</span> <span class="err">:</span> <span class="p">{}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>同样js和css中的配置方式和html中完全一致</p>

<h3 id="section-5">五、工作原理</h3>

<h4 id="section-6">1. 构建流程</h4>

<p>FIS3 是基于文件对象进行构建的，每个进入 FIS3 的文件都会实例化成一个 File 对象，整个构建过程都对这个对象进行操作完成构建任务。一个文件的构建流程分为三个阶段：</p>

<ul>
  <li>扫项目目录拿到文件并初始化出一个文件对象的列表，列表包含需要处理文件的文件对象</li>
  <li>对文件对象中每一个文件进行单文件编译</li>
  <li>获取用户设置的 package 插件，进行打包处理（包括合并图片）</li>
</ul>

<p>单文件进行处理的流程依次为：lint -&gt; parser -&gt; preprocessor -&gt; standard -&gt; postprocessor -&gt; optimizer。正如上面所配置的，这六个过程可以通过配置插件来定义我们最终想要的结果。例如，
lint 代码校验检查，比较特殊，所以需要 release 命令命令行添加 -l 参数
parser 预处理阶段，比如 less、sass、es6、react 前端模板等都在此处预编译处理
preprocessor 标准化前处理插件
standard 标准化插件，处理内置语法
postprocessor 标准化后处理插件</p>

<h3 id="file">2. File对象</h3>

<p>当一个文件被实例化为一个 File 对象后，包括一些文件基本属性，如 filename、realpath 等等，当这个文件被处理时，FIS3 还会把用户自定义的属性 merge 到文件对象上。例如</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre><span class="nx">fis</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="s1">'a.js'</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">myProp</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">});</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>fis将给这个a.js加上myPorp属性，有点类似与gulp的pipe处理。</p>

<h3 id="fis3">六、用fis3进行项目开发</h3>

<h4 id="section-7">1. 插件使用</h4>

<p>npm install -g 插件名 可以用来安装fis插件，插件列表见 http://npmsearch.com/?q=fis-parser%20fis3-parser
配置调试使用见上文的配置，fis3内置的插件如下，有这些觉得基本可以用来开发一个正式项目了。
fis-optimizer-clean-css
fis-optimizer-png-compressor
fis-optimizer-uglify-js
fis-spriter-csssprites
fis3-deploy-local-deliver
fis3-deploy-http-push
fis3-hook-components
fis3-packager-map</p>

<p>http://fis.baidu.com/fis3/docs/api/config-system-plugin.html</p>

<h4 id="section-8">2. 插件编写</h4>

<p>不到万不得已不要去扩展插件，用到的时候再说吧，fis3扩展了些插件，99%能满足开发需要。
####  3. 模块化开发
进行模块化开发首先安装npm install -g fis3-hook-module</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10</pre></td><td class="code"><pre><span class="nx">fis</span><span class="p">.</span><span class="nx">hook</span><span class="p">(</span><span class="s1">'module'</span><span class="p">);</span>


<span class="nx">fis</span><span class="p">.</span><span class="nx">hook</span><span class="p">(</span><span class="s1">'module'</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">mode</span><span class="p">:</span> <span class="s1">'amd'</span>    <span class="c1">//这里支持amd和commonJs</span>
<span class="p">});</span>

<span class="nx">fis</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="s1">'/module/*.js'</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">isMod</span><span class="p">:</span> <span class="kc">true</span> <span class="c1">// 标记匹配文件为组件</span>
<span class="p">});</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="section-9">2. 项目开发基本规范</h4>

<div class="language-javascript highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></td><td class="code"><pre><span class="c1">// 开发目录规范</span>
<span class="p">.</span>
<span class="err">├──</span> <span class="nx">page</span>    <span class="c1">// 放置页面模板</span>
<span class="err">│</span>   <span class="err">└──</span> <span class="nx">index</span><span class="p">.</span><span class="nx">html</span>
<span class="err">├──</span> <span class="kr">static</span>    <span class="c1">//公用静态资源</span>
<span class="err">│</span>   <span class="err">└──</span> <span class="nx">lib</span>    <span class="c1">//公用静态资源库。例如jquery、zepto等</span>
<span class="err">├──</span> <span class="nx">test</span>    <span class="c1">//一些测试数据和用例</span>
<span class="err">└──</span> <span class="nx">widget</span>    <span class="c1">//一切组件，包括模板、css、js、图片以及其他前端资源</span>
    <span class="err">├──</span> <span class="nx">header</span>
    <span class="err">├──</span> <span class="nx">nav</span>
    <span class="err">└──</span> <span class="nx">ui</span>

<span class="c1">//发布部署规范</span>
<span class="p">.</span>
<span class="err">├──</span> <span class="kr">static</span>    <span class="c1">//所有的静态资源都放到这个目录下</span>
<span class="err">├──</span> <span class="nx">template</span>    <span class="c1">//所有的模板都放到这个目录下</span>
<span class="err">└──</span> <span class="nx">test</span>    <span class="err">还是一些测试数据、用例</span>

<span class="c1">//构建工具配置</span>
<span class="nx">foo</span>
<span class="nx">foo</span><span class="o">/</span><span class="nx">bin</span><span class="o">/</span><span class="nx">foo</span><span class="p">.</span><span class="nx">js</span>
<span class="nx">foo</span><span class="o">/</span><span class="nx">index</span><span class="p">.</span><span class="nx">js</span>
<span class="kr">package</span><span class="p">.</span><span class="nx">json</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>基于 FIS3 配置目录规范和部署规范的配置文件编写：</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64</pre></td><td class="code"><pre><span class="c1">// 所有的文件产出到 static/ 目录下</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="s1">'*'</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">release</span><span class="p">:</span> <span class="s1">'/static/$0'</span>
<span class="p">});</span>
 
<span class="c1">// 所有模板放到 tempalte 目录下</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="s1">'*.html'</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">release</span><span class="p">:</span> <span class="s1">'/template/$0'</span>
<span class="p">});</span>
 
<span class="c1">// widget源码目录下的资源被标注为组件</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="s1">'/widget/**/*'</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">isMod</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">});</span>
 
<span class="c1">// widget下的 js 调用 jswrapper 进行自动化组件化封装</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="s1">'/widget/**/*.js'</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">postprocessor</span><span class="p">:</span> <span class="nx">fis</span><span class="p">.</span><span class="nx">plugin</span><span class="p">(</span><span class="s1">'jswrapper'</span><span class="p">,</span> <span class="p">{</span>
        <span class="na">type</span><span class="p">:</span> <span class="s1">'commonjs'</span>
    <span class="p">})</span>
<span class="p">});</span>
 
<span class="c1">// test 目录下的原封不动产出到 test 目录下</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="s1">'/test/**/*'</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">release</span><span class="p">:</span> <span class="s1">'$0'</span>
<span class="p">});</span>
 
<span class="c1">// optimize</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">media</span><span class="p">(</span><span class="s1">'prod'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="s1">'*.js'</span><span class="p">,</span> <span class="p">{</span>
        <span class="na">optimizer</span><span class="p">:</span> <span class="nx">fis</span><span class="p">.</span><span class="nx">plugin</span><span class="p">(</span><span class="s1">'uglify-js'</span><span class="p">,</span> <span class="p">{</span>
            <span class="na">mangle</span><span class="p">:</span> <span class="p">{</span>
                <span class="na">expect</span><span class="p">:</span> <span class="p">[</span><span class="s1">'require'</span><span class="p">,</span> <span class="s1">'define'</span><span class="p">,</span> <span class="s1">'some string'</span><span class="p">]</span> <span class="c1">//不想被压的</span>
            <span class="p">}</span>
        <span class="p">})</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="s1">'*.css'</span><span class="p">,</span> <span class="p">{</span>
        <span class="na">optimizer</span><span class="p">:</span> <span class="nx">fis</span><span class="p">.</span><span class="nx">plugin</span><span class="p">(</span><span class="s1">'clean-css'</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">'keepBreaks'</span><span class="p">:</span> <span class="kc">true</span> <span class="c1">//保持一个规则一个换行</span>
        <span class="p">})</span>
    <span class="p">});</span>
 
<span class="c1">// pack</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">media</span><span class="p">(</span><span class="s1">'prod'</span><span class="p">)</span>
    <span class="c1">// 启用打包插件，必须匹配 ::package</span>
    <span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="s1">'::package'</span><span class="p">,</span> <span class="p">{</span>
        <span class="na">packager</span><span class="p">:</span> <span class="nx">fis</span><span class="p">.</span><span class="nx">plugin</span><span class="p">(</span><span class="s1">'map'</span><span class="p">),</span>
        <span class="na">spriter</span><span class="p">:</span> <span class="nx">fis</span><span class="p">.</span><span class="nx">plugin</span><span class="p">(</span><span class="s1">'csssprites'</span><span class="p">,</span> <span class="p">{</span>
            <span class="na">layout</span><span class="p">:</span> <span class="s1">'matrix'</span><span class="p">,</span>
            <span class="na">margin</span><span class="p">:</span> <span class="s1">'15'</span>
        <span class="p">})</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="s1">'*.js'</span><span class="p">,</span> <span class="p">{</span>
        <span class="na">packTo</span><span class="p">:</span> <span class="s1">'/static/all_others.js'</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="s1">'*.css'</span><span class="p">,</span> <span class="p">{</span>
        <span class="na">packTo</span><span class="p">:</span> <span class="s1">'/staitc/all_others.js'</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="s1">'/widget/**/*.js'</span><span class="p">,</span> <span class="p">{</span>
        <span class="na">packTo</span><span class="p">:</span> <span class="s1">'/static/all_comp.js'</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="s1">'/widget/**/*.css'</span><span class="p">,</span> <span class="p">{</span>
        <span class="na">packTo</span><span class="p">:</span> <span class="s1">'/static/all_comp.css'</span>
    <span class="p">});</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>实现 /bin/foo.js</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></td><td class="code"><pre><span class="c1">// vi foo/bin/foo.js</span>
 
<span class="kd">var</span> <span class="nx">Liftoff</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'liftoff'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">argv</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'minimist'</span><span class="p">)(</span><span class="nx">process</span><span class="p">.</span><span class="nx">argv</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span>
<span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'path'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">cli</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Liftoff</span><span class="p">({</span>
  <span class="na">name</span><span class="p">:</span> <span class="s1">'foo'</span><span class="p">,</span> <span class="c1">// 命令名字</span>
  <span class="na">processTitle</span><span class="p">:</span> <span class="s1">'foo'</span><span class="p">,</span>
  <span class="na">moduleName</span><span class="p">:</span> <span class="s1">'foo'</span><span class="p">,</span>
  <span class="na">configName</span><span class="p">:</span> <span class="s1">'fis-conf'</span><span class="p">,</span>
 
  <span class="c1">// only js supported!</span>
  <span class="na">extensions</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">'.js'</span><span class="p">:</span> <span class="kc">null</span>
  <span class="p">}</span>
<span class="p">});</span>
 
<span class="nx">cli</span><span class="p">.</span><span class="nx">launch</span><span class="p">({</span>
  <span class="na">cwd</span><span class="p">:</span> <span class="nx">argv</span><span class="p">.</span><span class="nx">r</span> <span class="o">||</span> <span class="nx">argv</span><span class="p">.</span><span class="nx">root</span><span class="p">,</span>
  <span class="na">configPath</span><span class="p">:</span> <span class="nx">argv</span><span class="p">.</span><span class="nx">f</span> <span class="o">||</span> <span class="nx">argv</span><span class="p">.</span><span class="nx">file</span>
<span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">env</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">fis</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">env</span><span class="p">.</span><span class="nx">modulePath</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">fis</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'../'</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">fis</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="nx">env</span><span class="p">.</span><span class="nx">modulePath</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="nx">fis</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'system.localNPMFolder'</span><span class="p">,</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">env</span><span class="p">.</span><span class="nx">cwd</span><span class="p">,</span> <span class="s1">'node_modules/foo'</span><span class="p">));</span>
  <span class="nx">fis</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'system.globalNPMFolder'</span><span class="p">,</span> <span class="nx">path</span><span class="p">.</span><span class="nx">dirname</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">));</span>
  <span class="nx">fis</span><span class="p">.</span><span class="nx">cli</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="nx">argv</span><span class="p">,</span> <span class="nx">env</span><span class="p">);</span>
<span class="p">});</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h3 id="section-10">七、必须掌握的</h3>

<p>命令行 fis3 <command /> :</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre><span class="nx">fis3</span> <span class="nx">release</span> <span class="p">[</span><span class="o">-</span><span class="nx">d</span> <span class="nx">path</span><span class="p">]</span>     <span class="c1">//发布目录</span>
<span class="nx">fis3</span> <span class="nx">install</span> <span class="err">插件名</span>        <span class="c1">//安装一个插件</span>
<span class="nx">fis3</span> <span class="nx">init</span>     <span class="c1">//初始化一个项目</span>
<span class="nx">fis3</span> <span class="nx">server</span> <span class="p">[</span><span class="nx">start</span> <span class="o">|</span> <span class="nx">stop</span> <span class="o">|</span> <span class="nx">restart</span> <span class="o">|</span> <span class="nx">open</span> <span class="o">|</span> <span class="nx">info</span> <span class="p">]</span>      <span class="c1">//内置服务器操作</span>
<span class="nx">fis3</span> <span class="nx">inspect</span>     <span class="c1">//比较实用的命令，用来查看文件 match 结果</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>大概fis3文档的内容全部覆盖了，只有插件编写没有去深究。感觉整体能应对我们平时遇到的99%的问题。后面也靠fis团队更新插件了，至于缺少方便的插件的开发环境这点，个人觉得不到万不得已不要自己去造轮子，fis2很多插件缺少可以理解，后面还是尽量不要自己去造插件了。</p>


</article>


<div class="tags">
	<strong>Tags:</strong> <a target="_blank" href="/tags/?tag=fis3">fis3</a>
</div>


	<script src="/assets/js/github.comment.js"></script>
	<div class="gc-comments" data-repos="ouvens/ouvens.github.io" data-issues="3" >
	    <div class="gc-comments-title">
	        评论
	    </div>
	    <div class="gc-comments-info">
	        想在此留下评论，请访问 <a href="issues_link">issues_link</a> 提交评论
	    </div>
	</div>
</div>
</div>


    </div>
    
<div class="qr-code qr-code-pay" title="加个微信交流交流">
    <img src="/assets/qrcode/qr-code-person.jpg" width="200" height="200" alt="公众号">
    <p>加我赏红包，哈哈哈</p>
</div>

<div class="qr-code qr-code-wx" title="定期获取更新动态">
    <img src="/assets/qrcode/qrcode.jpg" width="200" height="200" alt="公众号">
    <p>欢迎关注 <strong>极限前端</strong> 公众号</p>
</div>


    
<footer class="site-footer">
  <div class="wrapper">
    <h3 class="footer-heading">极限前端</h3>
    <div class="site-navigation">
    	<p><strong>站内</strong></p>
      <ul class="pages">
        
        
          <li class="nav-link"><a href="/about/">关于</a>
        
        
        
        
        
        
        
        
        
          <li class="nav-link"><a href="/category/">所有文章</a>
        
        
        
          <li class="nav-link"><a href="/tags/">标签分类</a>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
      </ul>
    </div>
    <div class="site-contact">
    	<p><strong>相关链接</strong></p>
        <ul class="social-media-list">
      	<li>
      		<a href="mailto:1025224452@qq.com">
	      		<i class="icon-font i-star"></i>
	      		<span class="username">1025224452@qq.com</span>
      		</a>
      	</li>

      	
	      	
	      	<li>
	           <a href="https://github.com/ouvens" title="Fork me on GitHub">
	               <i class="icon-font i-heart"></i>
	               <span class="username">ouvens</span>
	           </a>
	        </li>
	      	
      	

      </ul>
    </div>
    <div class="site-signature">
    	<p class="rss-subscribe text"><strong>订阅<a href="/feed.xml">via RSS</a></strong></p>
      <p class="text">极限前端, 极限前端社区, ouven的博客, ouvenzhang的博客, www.jixianqianduan.com, github地址, 前端技术, 讲述前端高效技术与前沿。</p>
    </div>
  </div>
</footer>

<!-- Scripts -->
<script src="//1.url.cn/jslib/jquery/1.9.1/jquery.min.js" defer></script>

<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js" defer></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/lightbox2/2.7.1/js/lightbox.min.js" defer></script>

<script src="/assets/js/main.js" defer></script>

    </body>
</html>
