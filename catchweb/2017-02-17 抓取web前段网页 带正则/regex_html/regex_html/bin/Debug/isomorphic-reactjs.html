<!DOCTYPE html>
<html>
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="google-site-verification" content="0FNbiBWk1FugWYo-RiGxQyIHebGeLoXp3HB7AxIFKy8" />
    <meta name="baidu-site-verification" content="tYoUqpkCCv" />
    <meta name="baidu-site-verification" content="IGN97NW90O" />
    
    <title>isomorphic reactjs | ouvenzhang的博客</title>

    <meta http-equiv="x-dns-prefetch-control" content="on" />
    <link rel="dns-prefetch" href="cdnjs.cloudflare.com" />
    <link rel="dns-prefetch" href="1.url.cn" />

    <meta name="description" itemprop="description" content="isomorphic reactjs,isomorphic,reactjs,javascript ">
    <meta itemprop="name" content="isomorphic reactjs">
    <meta itemprop="image" content="http://ouvens.github.io/blog/assets/logo.png">
    <meta itemprop="keywords" name="keywords" content="isomorphic reactjs,isomorphic,reactjs,javascript ">

    
    <meta name="author" content="ouvenzhang">
    <meta name="copyright" content="&copy; ouvenzhang 2017">
    <meta name="protocol" content="1">
    

    <!-- External libraries -->
    <link rel="stylesheet" href="/assets/css/iconfont.css">
    <link rel="stylesheet" href="/css/monokai_sublime.css">

    <!-- Favicon and other icons (made with http://www.favicon-generator.org/) -->
    <link rel="shortcut icon" href="/assets/favicon.ico" type="image/x-icon">
  	<link rel="icon" href="/assets/favicon.ico" type="image/x-icon">
    
  	<meta name="msapplication-TileColor" content="#ffffff">
  	<meta name="theme-color" content="#ffffff">
    <meta name="msapplication-TileImage" content="/assets/icons/icon.png">

  	<!-- Site styles -->
    <link rel="stylesheet" href="/css/main.css">

    <link rel="alternate" type="application/rss+xml" title="极限前端" href="http://ouvens.github.io//feed.xml" />
    <script>
    // 访问统计
    var domain = 'jixianqianduan.com';
    var oldDomain = 'ouvens.github.io';
    if(location.host === domain){
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "//hm.baidu.com/hm.js?b536b128dc21c3d18fdc028f0609e3f0";
          var s = document.getElementsByTagName("script")[0]; 
          s.parentNode.insertBefore(hm, s);
        })();
    }else if(location.host === oldDomain){
        window.location.href = location.href.replace(oldDomain, domain);
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "//hm.baidu.com/hm.js?041efd2cb345ca1b9dbdbb2383cb716d";
          var s = document.getElementsByTagName("script")[0]; 
          s.parentNode.insertBefore(hm, s);
        })();
    }

    // 链接提交

    if(location.protocol === 'https'){
        !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=window.location.href,t=document.referrer;if(!e.test(r)){var o="https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif";t?(o+="?r="+encodeURIComponent(document.referrer),r&&(o+="&l="+r)):r&&(o+="?l="+r);var i=new Image;i.src=o}}(window);
    }else{
        !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=window.location.href,o=document.referrer;if(!e.test(r)){var n="//api.share.baidu.com/s.gif";o?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var t=new Image;t.src=n}}(window);
    }


    </script>
</head>

    <body>
        <div class="navigation" role="banner">
    <div class="navigation-wrapper">
    <a href="/" class="logo">
    	
      <img src="/assets/logo.png" alt="极限前端">
      
    </a>
    <span class="search-input" id="search-input">
      <input type="text" value="" class="search-text" placeholder="输入搜索关键字">
      <i class="icon-font i-search search-btn"></i>
    </span>
    <a href="javascript:void(0)" class="navigation-menu-button" id="js-mobile-menu">
    	<i class="icon-font i-list fa fa-bars"></i>
    </a>
    <span class="nav" role="navigation">
      <ul id="js-navigation-menu" class="navigation-menu show">
      	
          
          <li class="nav-link">
            <a href="/about/">关于</a>
          </li>
          
        
          
        
          
        
          
        
          
          <li class="nav-link">
            <a href="/category/">所有文章</a>
          </li>
          
        
          
          <li class="nav-link">
            <a href="/tags/">标签分类</a>
          </li>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          <li id="github-info" class="nav-link" title="https://github.com/ouvens">
            <a class="github-info" href="https://github.com/ouvens" target="_blank">
            <img src="/assets/github.png" height="34" width="130" alt="github地址"></a>
          </li>
      </ul>
    </span>
  </div>
</div>

            <div class="page-content">
        <div class="post">
<div class="post-header-container has-cover">
	<header class="post-header">
	  <h1 class="title">isomorphic reactjs</h1>
	  <p class="info">by <strong>ouven</strong></p>
	</header>
</div>
<div class="wrapper">



<div class="post-meta">
	<div class="post-date">2015年09月20日</div>
	<div class="post-categories">
	 in  
		<a target="_blank" href="/category/?cate=frontend-javascript">Frontend-javascript</a>
	  
	</div>
</div>	

<article class="post-content">
  <h4 id="isomorphic-javascript">isomorphic javascript</h4>
<p>web应用从最早静态页面、到php后台框架输出、到mv*为主的SPA、到基于node中层的直出，目前有人提出web的下次改变可能将是基于isomorphic javascript的前后台同构应用。</p>

<h4 id="web-app">一、目前主流web app的特点</h4>
<p>目前主要的应用都是基于mv*基础上(backbone、ember、angular等)或工程师自己的mvc思想上的应用。</p>

<p>通常做法是，页面所有的数据交互在客户端(一般指浏览器或移动webview)完成，后台只负责输出数据或一个初始的空白页面，而页面的数据则通过加载后的js进行加载渲染，一般用户和开发者的体验都会比较好，but存在很多问题:
- SEO不可做。除了基础的meta信息，基本没有全文信息。搜索引擎爬虫并不能获取页面内容。
- 性能仍有问题。大量的内容渲染，逻辑判断、dom操作、网络交互都在客户端完成，页面上的空白时间很容易让用户厌烦。
- 可维护性。有些低耦合的逻辑模块希望在前后台复用，例如时间格式化，表单验证，我们考虑到某些因素都会前后都做一次。</p>

<h4 id="isomorphic-javascript-1">二、Isomorphic JavaScript</h4>
<p>通过nodejs，可以轻松创建一个web server，运行js模板将页面输出给浏览器。但是Isomorphic JavaScript使用的是在服务端和客户端运行的一套代码，可以运行js模板或者前端的框架，这就是 “Isomorphic JavaScript”(同构的JavaScript)，借用一个图~</p>

<p><img src="http://7tszky.com1.z0.glb.clouddn.com/FraX78zGVUlBz-uBt2g6myNkA7uu" alt="" /></p>

<p>要做到这件事，有几件事情必须要解决：
- 抽象
- 路由
- 获取数据
- 视图渲染
- 自动构建打包</p>

<h4 id="isomorphic-reactjs">三、 Isomorphic reactjs</h4>
<p>基于这个思想，有人提出使用reactjs来进行直出，大致看下是怎么做的。
mv*驱动在客户端的dom渲染效率是很慢的，例如一个vm的生成要去扫描dom所有属性节点来获取directives、filter或者表达式。而且还有上面提到的三个问题，但是如果在服务端去做就可以解决这些性能问题。
但是问题来了，如何提前扫描节点生成vm，将里面所有的directive、filter和表达式输出呢？可行的做法是在构建混淆阶段去render出来，而且要对每个定义的节点属性的指令表达式去render，这样就行了。不过自己去做工作量就有些了，而且容易出问题</p>

<p>那用reactjs可以怎么搞？
http://reactjsnews.com/isomorphic-javascript-with-react-node/
看来又有人干了这件事情，思路类似，reactjs实现的原理是：使用react.renderToString方法将virtual dom转换为string输出到页面上。这样前端的react代码就完美在服务器跑起来了。</p>

<p>安装node-jsx，处理jsx语法：</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre><span class="nx">npm</span> <span class="nx">install</span> <span class="nx">node</span><span class="o">-</span><span class="nx">jsx</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>除了必要的工厂抽象模块，依然可以像原来一样书写react模块，这样既可以被前端打包处理，也可以通过node router render出来。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51</pre></td><td class="code"><pre> <span class="cm">/** @jsx React.DOM */</span>

<span class="kd">var</span> <span class="nx">React</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'react/addons'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">Mock</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'mockjs'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">Griddle</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createFactory</span><span class="p">(</span><span class="nx">require</span><span class="p">(</span><span class="s1">'griddle-react'</span><span class="p">));</span>
<span class="kd">var</span> <span class="nx">resultsPerPage</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">columnMeta</span> <span class="o">=</span> <span class="nx">Mock</span><span class="p">.</span><span class="nx">mock</span><span class="p">({</span>
    <span class="s1">'column'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'id'</span><span class="p">,</span> <span class="s1">'姓名'</span><span class="p">,</span> <span class="s1">'语文'</span><span class="p">,</span> <span class="s1">'数学'</span><span class="p">,</span> <span class="s1">'英语'</span><span class="p">,</span> <span class="s1">'历史'</span><span class="p">,</span> <span class="s1">'生物'</span><span class="p">],</span>
    <span class="s1">'order|+1'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s1">'locked'</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="s1">'visible'</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">fakeData</span> <span class="o">=</span> <span class="nx">Mock</span><span class="p">.</span><span class="nx">mock</span><span class="p">({</span>
    <span class="s1">'list|45'</span><span class="p">:</span> <span class="p">[{</span>
        <span class="s1">'id|+1'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s1">'姓名'</span><span class="p">:</span> <span class="s1">'@chineseName'</span><span class="p">,</span>
        <span class="s1">'语文 |40-100'</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
        <span class="s1">'数学 |40-100'</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
        <span class="s1">'英语 |40-100'</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
        <span class="s1">'历史 |40-100'</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
        <span class="s1">'生物 |40-100'</span><span class="p">:</span> <span class="mi">100</span>
    <span class="p">}]</span>
<span class="p">}).</span><span class="nx">list</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">ReactApp</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>

    <span class="na">componentDidMount</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">fakeData</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="na">render</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span> <span class="o">&lt;</span> <span class="nx">div</span> <span class="nx">id</span> <span class="o">=</span> <span class="s1">'table-area'</span> <span class="o">&gt;</span>
            <span class="o">&lt;</span> <span class="nx">Griddle</span> <span class="nx">results</span> <span class="o">=</span> <span class="p">{</span>
                <span class="nx">fakeData</span>
            <span class="p">}</span>
            <span class="nx">columnMetadata</span> <span class="o">=</span> <span class="p">{</span>
                <span class="nx">columnMeta</span>
            <span class="p">}</span>
            <span class="nx">resultsPerPage</span> <span class="o">=</span> <span class="p">{</span>
                <span class="nx">resultsPerPage</span>
            <span class="p">}</span>
            <span class="nx">tableClassName</span> <span class="o">=</span> <span class="s1">'table'</span> <span class="o">/</span> <span class="o">&gt;</span>
            <span class="o">&lt;</span> <span class="sr">/div</span><span class="err">&gt;
</span>        <span class="p">)</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="cm">/* Module.exports instead of normal dom mounting */</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">ReactApp</span><span class="p">;</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>解决路由问题：</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9</pre></td><td class="code"><pre><span class="kd">var</span> <span class="nx">React</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'react/addons'</span><span class="p">),</span>
<span class="nx">ReactApp</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createFactory</span><span class="p">(</span><span class="nx">require</span><span class="p">(</span><span class="s1">'../components/ReactApp'</span><span class="p">));</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
        <span class="kd">var</span> <span class="nx">reactHtml</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">renderToString</span><span class="p">(</span><span class="nx">ReactApp</span><span class="p">({}));</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">'index.ejs'</span><span class="p">,</span> <span class="p">{</span><span class="na">reactOutput</span><span class="p">:</span> <span class="nx">reactHtml</span><span class="p">});</span>
    <span class="p">});</span>

<span class="p">}</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>这里是关键，这里的renderToString将virtual dom直接转化成为html，这样就实现了直出的转换。</p>

<p>输出模板则可以这样写：</p>

<div class="language-html highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16</pre></td><td class="code"><pre><span class="cp">&lt;!doctype html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>react output demo<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">'/styles.css'</span> <span class="na">rel=</span><span class="s">"stylesheet"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1</span> <span class="na">id=</span><span class="s">"main-title"</span><span class="nt">&gt;</span>react output demo-成绩表<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"react-main-mount"</span><span class="nt">&gt;</span>
      <span class="err">&lt;</span>%- reactOutput %&gt;
    <span class="nt">&lt;/div&gt;</span>
    <span class="c">&lt;!-- comment out main.js to see server side only rendering --&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"/main.js"</span><span class="nt">&gt;&lt;/script&gt;</span>

  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>具体看个例子</p>

<p>https://github.com/ouvens/Isomorphic-reactjs/</p>

</article>


<div class="tags">
	<strong>Tags:</strong> <a target="_blank" href="/tags/?tag=isomorphic">isomorphic</a>,&nbsp;<a target="_blank" href="/tags/?tag=reactjs">reactjs</a>,&nbsp;<a target="_blank" href="/tags/?tag=javascript">javascript</a>
</div>


	<script src="/assets/js/github.comment.js"></script>
	<div class="gc-comments" data-repos="ouvens/ouvens.github.io" data-issues="3" >
	    <div class="gc-comments-title">
	        评论
	    </div>
	    <div class="gc-comments-info">
	        想在此留下评论，请访问 <a href="issues_link">issues_link</a> 提交评论
	    </div>
	</div>
</div>
</div>


    </div>
    
<div class="qr-code qr-code-pay" title="加个微信交流交流">
    <img src="/assets/qrcode/qr-code-person.jpg" width="200" height="200" alt="公众号">
    <p>加我赏红包，哈哈哈</p>
</div>

<div class="qr-code qr-code-wx" title="定期获取更新动态">
    <img src="/assets/qrcode/qrcode.jpg" width="200" height="200" alt="公众号">
    <p>欢迎关注 <strong>极限前端</strong> 公众号</p>
</div>


    
<footer class="site-footer">
  <div class="wrapper">
    <h3 class="footer-heading">极限前端</h3>
    <div class="site-navigation">
    	<p><strong>站内</strong></p>
      <ul class="pages">
        
        
          <li class="nav-link"><a href="/about/">关于</a>
        
        
        
        
        
        
        
        
        
          <li class="nav-link"><a href="/category/">所有文章</a>
        
        
        
          <li class="nav-link"><a href="/tags/">标签分类</a>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
      </ul>
    </div>
    <div class="site-contact">
    	<p><strong>相关链接</strong></p>
        <ul class="social-media-list">
      	<li>
      		<a href="mailto:1025224452@qq.com">
	      		<i class="icon-font i-star"></i>
	      		<span class="username">1025224452@qq.com</span>
      		</a>
      	</li>

      	
	      	
	      	<li>
	           <a href="https://github.com/ouvens" title="Fork me on GitHub">
	               <i class="icon-font i-heart"></i>
	               <span class="username">ouvens</span>
	           </a>
	        </li>
	      	
      	

      </ul>
    </div>
    <div class="site-signature">
    	<p class="rss-subscribe text"><strong>订阅<a href="/feed.xml">via RSS</a></strong></p>
      <p class="text">极限前端, 极限前端社区, ouven的博客, ouvenzhang的博客, www.jixianqianduan.com, github地址, 前端技术, 讲述前端高效技术与前沿。</p>
    </div>
  </div>
</footer>

<!-- Scripts -->
<script src="//1.url.cn/jslib/jquery/1.9.1/jquery.min.js" defer></script>

<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js" defer></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/lightbox2/2.7.1/js/lightbox.min.js" defer></script>

<script src="/assets/js/main.js" defer></script>

    </body>
</html>
