<!DOCTYPE html>
<html>
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="google-site-verification" content="0FNbiBWk1FugWYo-RiGxQyIHebGeLoXp3HB7AxIFKy8" />
    <meta name="baidu-site-verification" content="tYoUqpkCCv" />
    <meta name="baidu-site-verification" content="IGN97NW90O" />
    
    <title>react+redux+koa技术栈实现小结 | ouvenzhang的博客</title>

    <meta http-equiv="x-dns-prefetch-control" content="on" />
    <link rel="dns-prefetch" href="cdnjs.cloudflare.com" />
    <link rel="dns-prefetch" href="1.url.cn" />

    <meta name="description" itemprop="description" content="react+redux+koa技术栈实现小结,react,redux,fis3,koa ">
    <meta itemprop="name" content="react+redux+koa技术栈实现小结">
    <meta itemprop="image" content="http://ouvens.github.io/blog/assets/logo.png">
    <meta itemprop="keywords" name="keywords" content="react+redux+koa技术栈实现小结,react,redux,fis3,koa ">

    
    <meta name="author" content="ouvenzhang">
    <meta name="copyright" content="&copy; ouvenzhang 2017">
    <meta name="protocol" content="1">
    

    <!-- External libraries -->
    <link rel="stylesheet" href="/assets/css/iconfont.css">
    <link rel="stylesheet" href="/css/monokai_sublime.css">

    <!-- Favicon and other icons (made with http://www.favicon-generator.org/) -->
    <link rel="shortcut icon" href="/assets/favicon.ico" type="image/x-icon">
  	<link rel="icon" href="/assets/favicon.ico" type="image/x-icon">
    
  	<meta name="msapplication-TileColor" content="#ffffff">
  	<meta name="theme-color" content="#ffffff">
    <meta name="msapplication-TileImage" content="/assets/icons/icon.png">

  	<!-- Site styles -->
    <link rel="stylesheet" href="/css/main.css">

    <link rel="alternate" type="application/rss+xml" title="极限前端" href="http://ouvens.github.io//feed.xml" />
    <script>
    // 访问统计
    var domain = 'jixianqianduan.com';
    var oldDomain = 'ouvens.github.io';
    if(location.host === domain){
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "//hm.baidu.com/hm.js?b536b128dc21c3d18fdc028f0609e3f0";
          var s = document.getElementsByTagName("script")[0]; 
          s.parentNode.insertBefore(hm, s);
        })();
    }else if(location.host === oldDomain){
        window.location.href = location.href.replace(oldDomain, domain);
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "//hm.baidu.com/hm.js?041efd2cb345ca1b9dbdbb2383cb716d";
          var s = document.getElementsByTagName("script")[0]; 
          s.parentNode.insertBefore(hm, s);
        })();
    }

    // 链接提交

    if(location.protocol === 'https'){
        !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=window.location.href,t=document.referrer;if(!e.test(r)){var o="https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif";t?(o+="?r="+encodeURIComponent(document.referrer),r&&(o+="&l="+r)):r&&(o+="?l="+r);var i=new Image;i.src=o}}(window);
    }else{
        !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=window.location.href,o=document.referrer;if(!e.test(r)){var n="//api.share.baidu.com/s.gif";o?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var t=new Image;t.src=n}}(window);
    }


    </script>
</head>

    <body>
        <div class="navigation" role="banner">
    <div class="navigation-wrapper">
    <a href="/" class="logo">
    	
      <img src="/assets/logo.png" alt="极限前端">
      
    </a>
    <span class="search-input" id="search-input">
      <input type="text" value="" class="search-text" placeholder="输入搜索关键字">
      <i class="icon-font i-search search-btn"></i>
    </span>
    <a href="javascript:void(0)" class="navigation-menu-button" id="js-mobile-menu">
    	<i class="icon-font i-list fa fa-bars"></i>
    </a>
    <span class="nav" role="navigation">
      <ul id="js-navigation-menu" class="navigation-menu show">
      	
          
          <li class="nav-link">
            <a href="/about/">关于</a>
          </li>
          
        
          
        
          
        
          
        
          
          <li class="nav-link">
            <a href="/category/">所有文章</a>
          </li>
          
        
          
          <li class="nav-link">
            <a href="/tags/">标签分类</a>
          </li>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          <li id="github-info" class="nav-link" title="https://github.com/ouvens">
            <a class="github-info" href="https://github.com/ouvens" target="_blank">
            <img src="/assets/github.png" height="34" width="130" alt="github地址"></a>
          </li>
      </ul>
    </span>
  </div>
</div>

            <div class="page-content">
        <div class="post">
<div class="post-header-container has-cover">
	<header class="post-header">
	  <h1 class="title">react+redux+koa技术栈实现小结</h1>
	  <p class="info">by <strong>ouven</strong></p>
	</header>
</div>
<div class="wrapper">



<div class="post-meta">
	<div class="post-date">2017年01月10日</div>
	<div class="post-categories">
	 in  
		<a target="_blank" href="/category/?cate=frontend-build">Frontend-build</a>
	  
	</div>
</div>	

<article class="post-content">
  <p>  虽然别人整理的入门知识资料已经挺多的了，但不一定适合自己，还是重新整理下，理一理React的开发生态。</p>

<h4 id="react-">一、React 安装使用</h4>

<p>  使用react，只需要引入react.min.js（React 的核心库）和react-dom.min.js（提供与 DOM 相关的功能）即可。</p>

<div class="language-html highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11</pre></td><td class="code"><pre><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"../js/lib/react.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"../js/lib/react-dom.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>

<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"example"</span><span class="nt">&gt;&lt;/div&gt;</span>
<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/babel"</span><span class="nt">&gt;</span>
  <span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;</span><span class="nx">Hello</span><span class="p">,</span> <span class="nx">world</span><span class="o">!&lt;</span><span class="sr">/h1&gt;</span><span class="err">,
</span>    <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'example'</span><span class="p">)</span>
  <span class="p">);</span>
  <span class="c1">// 这段代码将一个h1标题，插入id="example"节点中</span>
<span class="nt">&lt;/script&gt;</span>
</pre></td></tr></tbody></table>
</div>
</div>

<blockquote>
  <p>通常为了使用JSX语法，我们需要在文件打包时使用插件将含有JSX语法的文件解析成普通的JavaScript语法，例如fis3-parser-react；如果使用到了ES6的写法，也需要将其转为ES5的格式，例如使用fis3-parser-babel。（现在前端已经不用ES6了，babel太慢影响效率，ES6在Node上使用）</p>
</blockquote>

<h4 id="react-jsx">二、React JSX</h4>

<p>  React使用JSX来替代常规的 JavaScript，以为JSX执行时进行了优化，含有错误检测而且方便我们书写模板。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12</pre></td><td class="code"><pre><span class="kd">var</span> <span class="nx">arr</span> <span class="o">=</span> <span class="p">[</span>
    <span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;</span><span class="nx">W3Cschool</span><span class="err">教程</span><span class="o">&lt;</span><span class="sr">/h1&gt;</span><span class="err">,
</span>    <span class="o">&lt;</span><span class="nx">h2</span><span class="o">&gt;</span><span class="err">从</span><span class="nx">W3Cschool</span><span class="err">开始！</span><span class="o">&lt;</span><span class="sr">/h2&gt;</span><span class="err">,
</span><span class="p">];</span>
<span class="kd">var</span> <span class="nx">mystyle</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">fontSize</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
    <span class="na">color</span><span class="p">:</span> <span class="s1">'#FF0000'</span>
<span class="p">};</span>
<span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span>
  <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">style</span><span class="o">=</span><span class="p">{</span><span class="nx">myStyle</span><span class="p">}</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">arr</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/div&gt;</span><span class="err">,
</span>  <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'example'</span><span class="p">)</span>
<span class="p">);</span>
</pre></td></tr></tbody></table>
</div>
</div>

<blockquote>
  <p>JSX语法代码实际上是JavaScript代码，所以html中的部分标签属性在JSX中不能直接使用，例如html class属性在JSX中需要使用className表示，for属性需要使用htmlFor代替，style属性标签中内容需要写成JSON格式。同时，JSX使用单个{}来包含变量模板，一次返回的JSX render内容必须放在单独一个标签内，返回统计的多个标签是不允许的，例如下面这样是不对的:</p>
</blockquote>

<div class="language-javascript highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6</pre></td><td class="code"><pre><span class="c1">// 不正确</span>
<span class="nl">render</span><span class="p">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="k">return</span> <span class="p">(</span><span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">site</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>    <span class="p">);</span>
<span class="p">}</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="react">三、React组件</h4>

<p>  实现了输出网站名字和网址的组件，另外if和for循环的输出大家也可以注意下:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61</pre></td><td class="code"><pre><span class="kd">var</span> <span class="nx">Name</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'Name'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">Link</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'LINK'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'list-item-1'</span><span class="p">,</span> <span class="s1">'list-item-2'</span><span class="p">,</span> <span class="s1">'list-item-3'</span><span class="p">];</span>

<span class="kd">var</span> <span class="nx">WebSite</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>
  <span class="na">getDefaultProps</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="na">name</span><span class="p">:</span> <span class="s1">'极限前端'</span><span class="p">,</span>
      <span class="na">site</span><span class="p">:</span> <span class="s2">"http://www.jixianqianduan.com"</span>
    <span class="p">};</span>
  <span class="p">},</span>
  <span class="na">render</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">hasList</span> <span class="o">=</span> <span class="nx">list</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">hasList</span><span class="p">){</span>
        <span class="k">return</span> <span class="p">(</span>
          <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">Name</span> <span class="nx">name</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="nx">Link</span> <span class="nx">site</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">site</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="nx">ul</span><span class="o">&gt;</span>
            <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">list</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="nx">index</span><span class="p">){</span>
                    <span class="k">return</span> <span class="o">&lt;</span><span class="nx">li</span> <span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="nx">index</span><span class="p">}</span><span class="o">&gt;</span><span class="nx">item</span><span class="o">&lt;</span><span class="sr">/li&gt;</span><span class="err">;
</span>                <span class="p">});</span>
            <span class="p">}</span>
            <span class="o">&lt;</span><span class="sr">/ul</span><span class="err">&gt;
</span>          <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>        <span class="p">)</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
        <span class="k">return</span> <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span><span class="err">没有数据</span><span class="o">&lt;</span><span class="sr">/div&gt;</span><span class="err">;
</span>    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="nx">React</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span>
  <span class="o">&lt;</span><span class="nx">WebSite</span> <span class="nx">name</span><span class="o">=</span><span class="s2">"极限前端"</span> <span class="nx">site</span><span class="o">=</span><span class="s2">"http://www.jixianqianduan.com"</span> <span class="o">/&gt;</span><span class="p">,</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'example'</span><span class="p">)</span>
<span class="p">);</span>

<span class="c1">// 文件Name.js</span>
<span class="kd">var</span> <span class="nx">Name</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>
  <span class="na">render</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/h1</span><span class="err">&gt;
</span>    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">Name</span><span class="p">;</span>

<span class="c1">// 文件Link.js</span>
<span class="kd">var</span> <span class="nx">Link</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>
  <span class="na">render</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">site</span><span class="p">}</span><span class="o">&gt;</span>
        <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">site</span><span class="p">}</span>
      <span class="o">&lt;</span><span class="sr">/a</span><span class="err">&gt;
</span>    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">Link</span><span class="p">;</span>
</pre></td></tr></tbody></table>
</div>
</div>

<blockquote>
  <p>最新版的React组件名称只允许使用大些字母开头的变量命名，例如x-button、my-button等命名方式都是不正确的。另外注意上面if模板和for循环输出模板的用法，循环输出时React要求列表项便签需要加上key的属性。</p>
</blockquote>

<h4 id="reactstateprops">四、React状态state和属性props</h4>

<p>  下面展示的一个典型实例中创建了 LikeButton 组件，getInitialState 方法用于定义初始状态，也就是一个对象，这个对象可以通过 this.state 属性读取。当用户点击组件，导致状态变化，this.setState 方法就修改状态值，每次修改以后，自动调用 this.render 方法，再次渲染组件。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21</pre></td><td class="code"><pre><span class="kd">var</span> <span class="nx">LikeButton</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>
  <span class="na">getInitialState</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span><span class="na">liked</span><span class="p">:</span> <span class="mi">0</span><span class="p">};</span>
  <span class="p">},</span>
  <span class="na">handleClick</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span><span class="na">liked</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">liked</span> <span class="o">+</span> <span class="mi">1</span><span class="p">});</span>
  <span class="p">},</span>
  <span class="na">render</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">text</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">liked</span> <span class="p">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">liked</span> <span class="p">:</span> <span class="s1">'不喜欢'</span><span class="p">;</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">p</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">handleClick</span><span class="p">}</span><span class="o">&gt;</span>
        <span class="err">你</span><span class="o">&lt;</span><span class="nx">b</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">text</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/b&gt;我。点我切换状态</span><span class="err">。
</span>      <span class="o">&lt;</span><span class="sr">/p</span><span class="err">&gt;
</span>    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="nx">React</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span>
  <span class="o">&lt;</span><span class="nx">LikeButton</span> <span class="o">/&gt;</span><span class="p">,</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'example'</span><span class="p">)</span>
<span class="p">);</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>  上面的例子也可以这样来做：</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51</pre></td><td class="code"><pre><span class="kd">var</span> <span class="nx">Name</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'Name'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">Link</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'LINK'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'list-item-1'</span><span class="p">,</span> <span class="s1">'list-item-2'</span><span class="p">,</span> <span class="s1">'list-item-3'</span><span class="p">];</span>

<span class="kd">var</span> <span class="nx">WebSite</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>
  <span class="na">getDefaultProps</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="na">name</span><span class="p">:</span> <span class="s1">'极限前端'</span><span class="p">,</span>
      <span class="na">site</span><span class="p">:</span> <span class="s2">"http://www.jixianqianduan.com"</span>
    <span class="p">};</span>
  <span class="p">},</span>
  
  <span class="c1">// 属性类型检测</span>
  <span class="na">propTypes</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">name</span><span class="p">:</span> <span class="nx">React</span><span class="p">.</span><span class="nx">PropTypes</span><span class="p">.</span><span class="nx">string</span><span class="p">.</span><span class="nx">isRequired</span><span class="p">,</span>
    <span class="na">site</span><span class="p">:</span> <span class="nx">React</span><span class="p">.</span><span class="nx">PropTypes</span><span class="p">.</span><span class="nx">string</span><span class="p">.</span><span class="nx">isRequired</span>
  <span class="p">},</span>
  
  <span class="na">getInitialState</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="na">name</span><span class="p">:</span> <span class="s1">'极限前端'</span><span class="p">,</span>
      <span class="na">site</span><span class="p">:</span> <span class="s2">"http://www.jixianqianduan.com"</span>
    <span class="p">};</span>
  <span class="p">},</span>
  
  <span class="na">render</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">hasList</span> <span class="o">=</span> <span class="nx">list</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">hasList</span><span class="p">){</span>
        <span class="k">return</span> <span class="p">(</span>
          <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">Name</span> <span class="nx">name</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="nx">Link</span> <span class="nx">site</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">site</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="nx">ul</span><span class="o">&gt;</span>
            <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">list</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="nx">index</span><span class="p">){</span>
                    <span class="k">return</span> <span class="o">&lt;</span><span class="nx">li</span> <span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="nx">index</span><span class="p">}</span><span class="o">&gt;</span><span class="nx">item</span><span class="o">&lt;</span><span class="sr">/li&gt;</span><span class="err">;
</span>                <span class="p">});</span>
            <span class="p">}</span>
            <span class="o">&lt;</span><span class="sr">/ul</span><span class="err">&gt;
</span>          <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>        <span class="p">)</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
        <span class="k">return</span> <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span><span class="err">没有数据</span><span class="o">&lt;</span><span class="sr">/div&gt;</span><span class="err">;
</span>    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="nx">React</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span>
  <span class="o">&lt;</span><span class="nx">WebSite</span> <span class="nx">name</span><span class="o">=</span><span class="s2">"极限前端"</span> <span class="nx">site</span><span class="o">=</span><span class="s2">"http://www.jixianqianduan.com"</span> <span class="o">/&gt;</span><span class="p">,</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'example'</span><span class="p">)</span>
<span class="p">);</span>
</pre></td></tr></tbody></table>
</div>
</div>

<blockquote>
  <p>state 和 props 主要的区别在于 props 是不可变的，而 state 可以根据与用户交互来改变。这就是为什么有些容器组件需要定义 state 来更新和修改数据。 而子组件只能通过 state 来传递数据。</p>
</blockquote>

<p>  组件的state和props常见有下面的管理方法：</p>

<div class="highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14</pre></td><td class="code"><pre>设置状态：setState, 不能在组件内部通过this.state修改状态，因为该状态会在调用setState()后被替换，setState()并不会立即改变this.state，而是创建一个即将处理的state。setState()并不一定是同步的，为了提升性能React会批量执行state和DOM渲染。
setState()总是会触发一次组件重绘，除非在shouldComponentUpdate()中实现了一些条件渲染逻辑。

替换状态：replaceState，replaceState()方法与setState()类似，但是方法只会保留nextState中状态，原state不在nextState中的状态都会被删除。

设置属性setProps，props相当于组件的数据流，它总是会从父组件向下传递至所有的子组件中。当和一个外部的JavaScript应用集成时，我们可能会需要向组件传递数据或通知React.render()组件需要重新渲染，可以使用setProps()。

替换属性replaceProps，replaceProps()方法与setProps类似，但它会删除原有

强制更新：forceUpdate，forceUpdate()方法会使组件调用自身的render()方法重新渲染组件，组件的子组件也会调用自己的render()。但是，组件重新渲染时，依然会读取this.props和this.state，如果状态没有改变，那么React只会更新DOM。

获取DOM节点：findDOMNode，如果组件已经挂载到DOM中，该方法返回对应的本地浏览器 DOM 元素。

判断组件挂载状态：isMounted，isMounted()方法用于判断组件是否已挂载到DOM中。可以使用该方法保证了setState()和forceUpdate()在异步场景下的调用不会出错。
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="section">五、组件生命周期</h4>

<ul>
  <li>初始化阶段：</li>
</ul>

<p>  getDefaultProps:获取实例的默认属性(即使没有生成实例，组件的第一个实例被初始化CreateClass的时候调用，只调用一次,)
  getInitialState:获取每个实例的初始化状态（每个实例自己维护）
  componentWillMount：组件即将被装载、渲染到页面上（render之前最好一次修改状态的机会）
  render:组件在这里生成虚拟的DOM节点（只能访问this.props和this.state；只有一个顶层组件，也就是说render返回值值职能是一个组件；不允许修改状态和DOM输出）
  componentDidMount:组件真正在被装载之后，可以修改DOM</p>

<ul>
  <li>运行中状态：</li>
</ul>

<p>  componentWillReceiveProps:组件将要接收到属性的时候调用（赶在父组件修改真正发生之前,可以修改属性和状态）
  shouldComponentUpdate:组件接受到新属性或者新状态的时候（可以返回false，接收数据后不更新，阻止render调用，后面的函数不会被继续执行了）
  componentWillUpdate:不能修改属性和状态
  render:只能访问this.props和this.state；只有一个顶层组件，也就是说render返回值只能是一个组件；不允许修改状态和DOM输出
  componentDidUpdate:可以修改DOM</p>

<ul>
  <li>销毁阶段：
  componentWillUnmount:开发者需要来销毁（组件真正删除之前调用，比如计时器和事件监听器）</li>
</ul>

<p><img src="http://7tszky.com1.z0.glb.clouddn.com/FhABffZwXfgMzo3nUNi2M6dgYxlD" alt="" /></p>

<blockquote>
  <p>React的网络请求通常是将请求的url放在组件props中传入，然后在componentDidMount时发送ajax请求。</p>
</blockquote>

<div class="language-javascript highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36</pre></td><td class="code"><pre><span class="kd">var</span> <span class="nx">UserGist</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>
  <span class="na">getInitialState</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="na">username</span><span class="p">:</span> <span class="s1">''</span><span class="p">,</span>
      <span class="na">lastGistUrl</span><span class="p">:</span> <span class="s1">''</span>
    <span class="p">};</span>
  <span class="p">},</span>

  <span class="na">componentDidMount</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">serverRequest</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">source</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">lastGist</span> <span class="o">=</span> <span class="nx">result</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span>
        <span class="na">username</span><span class="p">:</span> <span class="nx">lastGist</span><span class="p">.</span><span class="nx">owner</span><span class="p">.</span><span class="nx">login</span><span class="p">,</span>
        <span class="na">lastGistUrl</span><span class="p">:</span> <span class="nx">lastGist</span><span class="p">.</span><span class="nx">html_url</span>
      <span class="p">});</span>
    <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
  <span class="p">},</span>

  <span class="na">componentWillUnmount</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">serverRequest</span><span class="p">.</span><span class="nx">abort</span><span class="p">();</span>
  <span class="p">},</span>

  <span class="na">render</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
        <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">username</span><span class="p">}</span> <span class="err">用户最新的</span> <span class="nx">Gist</span> <span class="err">共享地址：</span>
        <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">lastGistUrl</span><span class="p">}</span><span class="o">&gt;</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">lastGistUrl</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/a</span><span class="err">&gt;
</span>      <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span>
  <span class="o">&lt;</span><span class="nx">UserGist</span> <span class="nx">source</span><span class="o">=</span><span class="s2">"https://api.github.com/users/ouven/gists"</span> <span class="o">/&gt;</span><span class="p">,</span>
  <span class="nx">mountNode</span>
<span class="p">);</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="refs">六、refs</h4>

<p>  如果绑定一个 ref 属性到render内容的返回值上，组件或其它组件就可以这样来引用这个内容关联的DOM元素。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre><span class="o">&lt;</span><span class="nx">input</span> <span class="nx">ref</span><span class="o">=</span><span class="s2">"myInput"</span> <span class="o">/&gt;</span>

<span class="kd">var</span> <span class="nx">input</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">refs</span><span class="p">.</span><span class="nx">myInput</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">inputValue</span> <span class="o">=</span> <span class="nx">input</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">inputRect</span> <span class="o">=</span> <span class="nx">input</span><span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">();</span>
</pre></td></tr></tbody></table>
</div>
</div>

<blockquote>
  <p>我们也可以使用getDOMNode()方法获取当前真实DOM元素，但是findDOMNode()不能用在无状态组件上。此外也可以使用bind的方法来实现当前事件的处理。</p>
</blockquote>

<div class="language-javascript highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10</pre></td><td class="code"><pre><span class="nx">componentDidMound</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">el</span> <span class="o">=</span> <span class="nx">findDOMNode</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// do something ...</span>
<span class="nx">onClick</span> <span class="o">=</span> <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">handleClick</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">value1</span><span class="p">,</span> <span class="nx">value2</span><span class="p">)}</span>

<span class="c1">// do something </span>
<span class="nx">handleClick</span><span class="p">(</span><span class="nx">value1</span><span class="p">,</span> <span class="nx">value2</span><span class="p">,</span> <span class="p">...,</span> <span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 事件处理函数</span>
<span class="p">}</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="ssr">七、服务端渲染(SSR)</h4>

<p>  React服务端渲染需要用到react-dom/server模块，以koa(koa使用教程省略)为例，我们渲染一个服务端返回的页面就可以这样写：</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41</pre></td><td class="code"><pre><span class="cm">/**
 * react前后端同构页面
 * @param {[type]} req           [description]
 * @param {[type]} res           [description]
 * @yield {[type]} [description]
 */</span>
<span class="kr">const</span> <span class="nx">reactController</span> <span class="o">=</span> <span class="kd">function</span><span class="o">*</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>

    <span class="kd">let</span> <span class="nx">ctx</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="kd">let</span> <span class="nx">helloProps</span> <span class="o">=</span> <span class="p">{</span>
        <span class="na">type</span><span class="p">:</span> <span class="s1">'hello'</span><span class="p">,</span>
        <span class="na">data</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">name</span><span class="p">:</span> <span class="s1">'hello-name-init'</span><span class="p">,</span>
            <span class="na">address</span><span class="p">:</span> <span class="s1">'hello-address-init'</span><span class="p">,</span>
            <span class="na">age</span><span class="p">:</span> <span class="s1">'26'</span><span class="p">,</span>
            <span class="na">job</span><span class="p">:</span> <span class="s1">'hello-job-init'</span>
        <span class="p">}</span>
    <span class="p">};</span>

    <span class="kd">let</span> <span class="nx">contentProps</span> <span class="o">=</span> <span class="p">{</span>
        <span class="na">type</span><span class="p">:</span> <span class="s1">'content'</span><span class="p">,</span>
        <span class="na">data</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">name</span><span class="p">:</span> <span class="s1">'content-name-init'</span><span class="p">,</span>
            <span class="na">address</span><span class="p">:</span> <span class="s1">'content-address-init'</span><span class="p">,</span>
            <span class="na">age</span><span class="p">:</span> <span class="s1">'26'</span><span class="p">,</span>
            <span class="na">job</span><span class="p">:</span> <span class="s1">'content-job-init'</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">let</span> <span class="nx">reactHello</span> <span class="o">=</span> <span class="nx">reactComponent</span><span class="p">.</span><span class="nx">renderPath</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="s1">'react/react-hello/main.jsx'</span><span class="p">,</span> <span class="nx">helloProps</span><span class="p">);</span>
    <span class="kd">let</span> <span class="nx">reactContent</span> <span class="o">=</span> <span class="nx">reactComponent</span><span class="p">.</span><span class="nx">renderPath</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="s1">'react/react-content/main.jsx'</span><span class="p">,</span> <span class="nx">contentProps</span><span class="p">);</span>

    <span class="nx">ctx</span><span class="p">.</span><span class="nx">body</span> <span class="o">=</span> <span class="k">yield</span> <span class="nx">render</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="s1">'pages/react'</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">reactHello</span><span class="p">,</span>
        <span class="nx">reactContent</span><span class="p">,</span>
        <span class="na">storeData</span><span class="p">:</span> <span class="p">{</span>
            <span class="nx">helloProps</span><span class="p">,</span>
            <span class="nx">contentProps</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">};</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>  这里用到了一个统一react的render处理模块:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34</pre></td><td class="code"><pre>
<span class="s1">'use strict'</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">React</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'react'</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">ReactDOM</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'react-dom'</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">ReactDOMServer</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'react-dom/server'</span><span class="p">);</span>

<span class="cm">/**
 * 根据开发或正式环境读取不同目录先的jsx组件
 * @param  {[type]} ctx        [当前运行环境，用于判断使用开发环境路径还是线上环境路径]
 * @param  {[type]} componentPath [接受组件路径名]
 * @param  {[type]} props      [组件接受的数据]
 * @return {[type]}            [description]
 */</span>
<span class="kr">const</span> <span class="nx">renderPath</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="nx">componentPath</span><span class="p">,</span> <span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">componentFactory</span><span class="p">,</span>
        <span class="nx">jsxPath</span><span class="p">;</span>
    <span class="c1">// 如果是本地则使用dev环境目录，否则使用page的构建目录</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">hostname</span> <span class="o">===</span> <span class="s1">'127.0.0.1'</span> <span class="o">||</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">hostname</span> <span class="o">===</span> <span class="s1">'localhost'</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">jsxPath</span> <span class="o">=</span> <span class="s1">'../dev/component/'</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">jsxPath</span> <span class="o">=</span> <span class="s1">'../pages/component/'</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">componentFactory</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createFactory</span><span class="p">(</span><span class="nx">require</span><span class="p">(</span><span class="nx">jsxPath</span> <span class="o">+</span> <span class="nx">componentPath</span><span class="p">));</span>

    <span class="cm">/**
     * renderToStaticMarkup不会避免前端重渲染
     * renderToString会避免前端重渲染
     */</span>
    <span class="k">return</span> <span class="nx">ReactDOMServer</span><span class="p">.</span><span class="nx">renderToString</span><span class="p">(</span><span class="nx">componentFactory</span><span class="p">(</span><span class="nx">props</span><span class="p">));</span>
<span class="p">};</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">renderPath</span><span class="p">:</span> <span class="nx">renderPath</span>
<span class="p">}</span>
</pre></td></tr></tbody></table>
</div>
</div>

<blockquote>
  <p>这里这样做还不够，我们还需要将renderToString的字符串内容填充到真正的页面模板中，这里以swig模板为例，同时后端渲染的初始数据状态也要通过storeData变量带到前端页面上，保证初始的页面组件状态和后端直出是一样的。</p>
</blockquote>

<div class="language-html highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9</pre></td><td class="code"><pre><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"testHello"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div&gt;&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"test"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div&gt;&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;script&gt;</span>
<span class="kd">var</span> <span class="nx">storeData</span> <span class="o">=</span> <span class="p">;</span>
<span class="nt">&lt;/script&gt;</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="redux">八、Redux与组件通信</h4>

<p>  React组件间的通信分为几种，父组件向子组件通信、子组件向父组件通信、同级组件间通信。第一种通常是将父组件的state传给子组件props来实现，父组件state变化，子组件的状态就直接变化；子组件向父组件通信是将父组件的方法通过props传入的子组件中，然后再子组件中调用来通知父组件；同级组件通信则是创建一个共同父组件，先发起子组件向父组件通信，然后再让父组件向另一子组件发起通信。
  另一种通用的机制就是Redux，Redux可以创建一个全局的store，统一保存管理不同组件的状态，然后通过subscribe订阅事件，当dispatch调用时可以修改组件状态触发订阅事件重新渲染视图。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18</pre></td><td class="code"><pre><span class="kd">var</span> <span class="nx">reactContent</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'react-content'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">reactHello</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'react-hello'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">store</span> <span class="o">=</span> <span class="nx">Redux</span><span class="p">.</span><span class="nx">createStore</span><span class="p">(</span><span class="nx">reducer</span><span class="p">);</span>

<span class="kd">function</span> <span class="nx">reducer</span><span class="p">(</span><span class="nx">state</span><span class="o">=</span><span class="p">{},</span> <span class="nx">action</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">type</span><span class="p">){</span>
        <span class="nx">state</span><span class="p">[</span><span class="nx">action</span><span class="p">.</span><span class="nx">type</span><span class="p">]</span> <span class="o">=</span> <span class="nx">action</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">state</span><span class="p">;</span>
<span class="p">};</span>

<span class="c1">// do somthing...</span>
<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">storeData</span><span class="p">){</span>
    <span class="nx">store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">storeData</span><span class="p">[</span><span class="nx">key</span><span class="p">]);</span>
<span class="p">}</span>
<span class="c1">// do somthing...</span>
<span class="nx">reactContent</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">store</span><span class="p">);</span>
<span class="nx">reactHello</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">store</span><span class="p">);</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>  此时如果react-content组件重要控制react-hello组件状态的变化，reactHello中就可以这样监听</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11</pre></td><td class="code"><pre><span class="nx">componentDidMount</span><span class="err">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">store</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">store</span><span class="p">;</span>
    <span class="kd">function</span> <span class="nx">handleChange</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="na">data</span><span class="p">:</span> <span class="nx">store</span><span class="p">.</span><span class="nx">getState</span><span class="p">()[</span><span class="s1">'hello'</span><span class="p">]</span> <span class="p">});</span>
    <span class="p">}</span>

    <span class="c1">// 订阅store变化，如果有dispatch，handleChange里面的状态设置就会执行</span>
    <span class="kd">let</span> <span class="nx">unsubscribe</span> <span class="o">=</span> <span class="nx">store</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">handleChange</span><span class="p">);</span>
    <span class="c1">// unsubscribe(); 取消订阅</span>
<span class="p">}</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>  reactContent中控制reactHello变化的动作中则需要这样写。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13</pre></td><td class="code"><pre><span class="c1">// 触发reactHello组件变化</span>
<span class="nl">_triggerHello</span><span class="p">:</span> <span class="kd">function</span><span class="p">(){</span>

    <span class="c1">// 修改hello组件的store</span>
    <span class="kd">var</span> <span class="nx">hello</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">store</span><span class="p">.</span><span class="nx">getState</span><span class="p">()[</span><span class="s1">'hello'</span><span class="p">];</span>
    <span class="nx">hello</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s1">'ouvenzhang'</span><span class="p">;</span>

    <span class="c1">// dispatch后会触发reactHello中的handleChange</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">({</span>
        <span class="na">type</span><span class="p">:</span> <span class="s1">'hello'</span><span class="p">,</span>
        <span class="na">data</span><span class="p">:</span> <span class="nx">hello</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></td></tr></tbody></table>
</div>
</div>

<blockquote>
  <p>其实我们可以在SSR时也使用Redux管理，可以增强组件的一部分复用性，但目前还没有用到，其实redux是用来管理组件状态变化的，更推荐在前端使用，服务端使用感觉有点不大必要，服务端只用来做首次内容的渲染。</p>
</blockquote>

<h4 id="section-1">九、事件</h4>

<p>  React自定义了一些事件，可以方便我们的开发使用。</p>

<p>stopPropagation() 和 preventDefault()，React标准化了事件对象，因此在不同的浏览器中都会有相同的属性。事件处理器也可以在事件冒泡阶段触发。要在捕获阶段触发某个事件处理器，在事件名字后面追加Capture字符串；例如，使用onClickCapture而不是onClick来在捕获阶段处理点击事件</p>

<ul>
  <li>系统事件</li>
</ul>

<p>onCopy onCut onPaste</p>

<ul>
  <li>键盘事件</li>
</ul>

<p>onKeyDown onKeyPress onKeyUp</p>

<ul>
  <li>表单事件</li>
</ul>

<p>onFocus onBlur onChange onInput onSubmit</p>

<ul>
  <li>鼠标事件</li>
</ul>

<p>onClick onDoubleClick onDrag onDragEnd onDragEnter onDragExitonDragLeave
onDragOver onDragStart onDrop onMouseDown onMouseEnteronMouseLeave
onMouseMove onMouseOut onMouseOver onMouseUp</p>

<ul>
  <li>触摸事件</li>
</ul>

<p>onTouchCancel onTouchEnd onTouchMove onTouchStart</p>

<ul>
  <li>窗口和滚轮事件</li>
</ul>

<p>onScroll onWheel</p>

<h4 id="section-2">十、小结</h4>
<p>  总得来说react生态的还是很健全的，解决的了实际开发中组件和组件状态管理的问题，前后端同构的模式也解决了React库本身较大前端加载缓慢的弊端，但是如果实际项目中没有Node服务层，个人建议还是不要直接使用React，React库文件比较大，还需要其它的依赖，会大大延后页面渲染时机，这是例如使用Vue会显得更轻量级。</p>

<p>工程化项目代码样例：<a href="https://github.com/ouvens/fis3-koa-node">https://github.com/ouvens/fis3-koa-node</a> （内含react的页面，可直接用来开发大型项目）</p>

</article>


<div class="tags">
	<strong>Tags:</strong> <a target="_blank" href="/tags/?tag=react">react</a>,&nbsp;<a target="_blank" href="/tags/?tag=redux">redux</a>,&nbsp;<a target="_blank" href="/tags/?tag=fis3">fis3</a>,&nbsp;<a target="_blank" href="/tags/?tag=koa">koa</a>
</div>


	<script src="/assets/js/github.comment.js"></script>
	<div class="gc-comments" data-repos="ouvens/ouvens.github.io" data-issues="3" >
	    <div class="gc-comments-title">
	        评论
	    </div>
	    <div class="gc-comments-info">
	        想在此留下评论，请访问 <a href="issues_link">issues_link</a> 提交评论
	    </div>
	</div>
</div>
</div>


    </div>
    
<div class="qr-code qr-code-pay" title="加个微信交流交流">
    <img src="/assets/qrcode/qr-code-person.jpg" width="200" height="200" alt="公众号">
    <p>加我赏红包，哈哈哈</p>
</div>

<div class="qr-code qr-code-wx" title="定期获取更新动态">
    <img src="/assets/qrcode/qrcode.jpg" width="200" height="200" alt="公众号">
    <p>欢迎关注 <strong>极限前端</strong> 公众号</p>
</div>


    
<footer class="site-footer">
  <div class="wrapper">
    <h3 class="footer-heading">极限前端</h3>
    <div class="site-navigation">
    	<p><strong>站内</strong></p>
      <ul class="pages">
        
        
          <li class="nav-link"><a href="/about/">关于</a>
        
        
        
        
        
        
        
        
        
          <li class="nav-link"><a href="/category/">所有文章</a>
        
        
        
          <li class="nav-link"><a href="/tags/">标签分类</a>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
      </ul>
    </div>
    <div class="site-contact">
    	<p><strong>相关链接</strong></p>
        <ul class="social-media-list">
      	<li>
      		<a href="mailto:1025224452@qq.com">
	      		<i class="icon-font i-star"></i>
	      		<span class="username">1025224452@qq.com</span>
      		</a>
      	</li>

      	
	      	
	      	<li>
	           <a href="https://github.com/ouvens" title="Fork me on GitHub">
	               <i class="icon-font i-heart"></i>
	               <span class="username">ouvens</span>
	           </a>
	        </li>
	      	
      	

      </ul>
    </div>
    <div class="site-signature">
    	<p class="rss-subscribe text"><strong>订阅<a href="/feed.xml">via RSS</a></strong></p>
      <p class="text">极限前端, 极限前端社区, ouven的博客, ouvenzhang的博客, www.jixianqianduan.com, github地址, 前端技术, 讲述前端高效技术与前沿。</p>
    </div>
  </div>
</footer>

<!-- Scripts -->
<script src="//1.url.cn/jslib/jquery/1.9.1/jquery.min.js" defer></script>

<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js" defer></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/lightbox2/2.7.1/js/lightbox.min.js" defer></script>

<script src="/assets/js/main.js" defer></script>

    </body>
</html>
